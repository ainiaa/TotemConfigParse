package com.coding91.ui;

import com.coding91.parser.ConfigParserDispatch;
import totemconfigparse.*;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.OutputStreamWriter;
import java.io.UnsupportedEncodingException;
import java.io.Writer;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Properties;
import java.util.TimeZone;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JFileChooser;
import javax.swing.JFrame;
import javax.swing.JOptionPane;
import javax.swing.UIManager;
import javax.swing.UnsupportedLookAndFeelException;
import jxl.Cell;
import jxl.CellType;
import jxl.DateCell;
import jxl.Sheet;
import jxl.Workbook;
import jxl.WorkbookSettings;
import jxl.read.biff.BiffException;

/**
 *
 * @author Administrator
 */
public class DessertShopConfigParseJFrame extends javax.swing.JFrame {

    /**
     * Creates new form TotemConfigParseJFrame
     */
    public DessertShopConfigParseJFrame() {
        loadSetting("./setting.properties");
        initComponents();

    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        funcbuttonGroup = new javax.swing.ButtonGroup();
        allInOnejbuttonGroup = new javax.swing.ButtonGroup();
        jLayeredPane = new javax.swing.JLayeredPane();
        funjPanel = new javax.swing.JPanel();
        shopObjItemjRadioButton = new javax.swing.JRadioButton();
        activityLibraryjRadioButton = new javax.swing.JRadioButton();
        avatarItemsjRadioButton = new javax.swing.JRadioButton();
        bindingRecipejRadioButton = new javax.swing.JRadioButton();
        feedInfojRadioButton = new javax.swing.JRadioButton();
        goodsOrderjRadioButton = new javax.swing.JRadioButton();
        requestInfojRadioButton = new javax.swing.JRadioButton();
        gamejRadioButton = new javax.swing.JRadioButton();
        missionInfojRadioButton = new javax.swing.JRadioButton();
        dessertInfojRadioButton = new javax.swing.JRadioButton();
        selectConfgFilejPanel = new javax.swing.JPanel();
        configFilejLabel = new javax.swing.JLabel();
        configFilejTextField = new javax.swing.JTextField();
        configFilejButton = new javax.swing.JButton();
        outputjLabel = new javax.swing.JLabel();
        outputjTextField = new javax.swing.JTextField();
        outputjButton = new javax.swing.JButton();
        operationjPanel = new javax.swing.JPanel();
        parsejButton = new javax.swing.JButton();
        closejButton = new javax.swing.JButton();
        dsParseConfjToolBar = new javax.swing.JToolBar();
        bottomStatusjLabel = new javax.swing.JLabel();
        allInOnejPanel = new javax.swing.JPanel();
        allInOneYesjRadioButton = new javax.swing.JRadioButton();
        allInOneNojRadioButton = new javax.swing.JRadioButton();
        jMenuBar = new javax.swing.JMenuBar();
        filejMenu = new javax.swing.JMenu();
        settingjMenuItem = new javax.swing.JMenuItem();
        editjMenu = new javax.swing.JMenu();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        funjPanel.setBorder(javax.swing.BorderFactory.createTitledBorder("解析内容"));

        funcbuttonGroup.add(shopObjItemjRadioButton);
        shopObjItemjRadioButton.setSelected(true);
        shopObjItemjRadioButton.setText("shopItem");
        shopObjItemjRadioButton.setActionCommand("DS_SHOP_OBJ_ITEM");

        funcbuttonGroup.add(activityLibraryjRadioButton);
        activityLibraryjRadioButton.setText("activityLibraryInfo");
        activityLibraryjRadioButton.setActionCommand("ACTIVITY_LIB");

        funcbuttonGroup.add(avatarItemsjRadioButton);
        avatarItemsjRadioButton.setText("avatarItems");
        avatarItemsjRadioButton.setActionCommand("AVATAR_ITEMS");

        funcbuttonGroup.add(bindingRecipejRadioButton);
        bindingRecipejRadioButton.setText("bindingRecipe");
        bindingRecipejRadioButton.setActionCommand("BINDING_RECIPE");

        funcbuttonGroup.add(feedInfojRadioButton);
        feedInfojRadioButton.setText("feedInfo");
        feedInfojRadioButton.setActionCommand("FEED_INFO");

        funcbuttonGroup.add(goodsOrderjRadioButton);
        goodsOrderjRadioButton.setText("goodsOrder");
        goodsOrderjRadioButton.setActionCommand("GOODS_ORDER");

        funcbuttonGroup.add(requestInfojRadioButton);
        requestInfojRadioButton.setText("requestInfo");
        requestInfojRadioButton.setActionCommand("REQUEST_INFO");

        funcbuttonGroup.add(gamejRadioButton);
        gamejRadioButton.setText("game");
        gamejRadioButton.setActionCommand("GAME");

        funcbuttonGroup.add(missionInfojRadioButton);
        missionInfojRadioButton.setText("missionInfo");
        missionInfojRadioButton.setActionCommand("MISSION_INFO");

        funcbuttonGroup.add(dessertInfojRadioButton);
        dessertInfojRadioButton.setText("dessertInfo");
        dessertInfojRadioButton.setActionCommand("DESSERT_INFO");

        javax.swing.GroupLayout funjPanelLayout = new javax.swing.GroupLayout(funjPanel);
        funjPanel.setLayout(funjPanelLayout);
        funjPanelLayout.setHorizontalGroup(
            funjPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(funjPanelLayout.createSequentialGroup()
                .addGap(0, 0, 0)
                .addGroup(funjPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(bindingRecipejRadioButton)
                    .addComponent(shopObjItemjRadioButton)
                    .addComponent(missionInfojRadioButton))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(funjPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(funjPanelLayout.createSequentialGroup()
                        .addGroup(funjPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(feedInfojRadioButton)
                            .addComponent(activityLibraryjRadioButton))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(funjPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(avatarItemsjRadioButton)
                            .addComponent(requestInfojRadioButton))
                        .addGap(27, 27, 27)
                        .addGroup(funjPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(gamejRadioButton)
                            .addComponent(goodsOrderjRadioButton)))
                    .addComponent(dessertInfojRadioButton))
                .addContainerGap(63, Short.MAX_VALUE))
        );
        funjPanelLayout.setVerticalGroup(
            funjPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(funjPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(funjPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(shopObjItemjRadioButton)
                    .addComponent(activityLibraryjRadioButton)
                    .addComponent(avatarItemsjRadioButton)
                    .addComponent(goodsOrderjRadioButton))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(funjPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(bindingRecipejRadioButton)
                    .addComponent(feedInfojRadioButton)
                    .addComponent(requestInfojRadioButton)
                    .addComponent(gamejRadioButton))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(funjPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(missionInfojRadioButton)
                    .addComponent(dessertInfojRadioButton))
                .addContainerGap(57, Short.MAX_VALUE))
        );

        jLayeredPane.add(funjPanel);
        funjPanel.setBounds(10, 0, 520, 160);

        selectConfgFilejPanel.setBorder(javax.swing.BorderFactory.createTitledBorder("选择配置文件"));

        configFilejLabel.setText("配置文件：");

        configFilejTextField.setText(configBaseDir);
        configFilejTextField.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                configFilejTextFieldMouseClicked(evt);
            }
        });

        configFilejButton.setText("浏览");
        configFilejButton.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                configFilejButtonMouseClicked(evt);
            }
        });

        outputjLabel.setText("输出目录：");

        outputjTextField.setText(outputDirectory);
        outputjTextField.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                outputjTextFieldMouseClicked(evt);
            }
        });

        outputjButton.setText("浏览");
        outputjButton.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                outputjButtonMouseClicked(evt);
            }
        });

        javax.swing.GroupLayout selectConfgFilejPanelLayout = new javax.swing.GroupLayout(selectConfgFilejPanel);
        selectConfgFilejPanel.setLayout(selectConfgFilejPanelLayout);
        selectConfgFilejPanelLayout.setHorizontalGroup(
            selectConfgFilejPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(selectConfgFilejPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(selectConfgFilejPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(outputjLabel)
                    .addComponent(configFilejLabel))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(selectConfgFilejPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(configFilejTextField, javax.swing.GroupLayout.DEFAULT_SIZE, 293, Short.MAX_VALUE)
                    .addComponent(outputjTextField))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(selectConfgFilejPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(configFilejButton, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(outputjButton, javax.swing.GroupLayout.Alignment.TRAILING))
                .addGap(78, 78, 78))
        );
        selectConfgFilejPanelLayout.setVerticalGroup(
            selectConfgFilejPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(selectConfgFilejPanelLayout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(selectConfgFilejPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(configFilejLabel)
                    .addComponent(configFilejTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(configFilejButton))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(selectConfgFilejPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(outputjLabel)
                    .addComponent(outputjTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(outputjButton))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jLayeredPane.add(selectConfgFilejPanel);
        selectConfgFilejPanel.setBounds(10, 220, 520, 80);

        operationjPanel.setBorder(javax.swing.BorderFactory.createTitledBorder("操作"));

        parsejButton.setText("解析");
        parsejButton.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                parsejButtonMouseClicked(evt);
            }
        });

        closejButton.setText("取消");
        closejButton.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                closejButtonMouseClicked(evt);
            }
        });

        javax.swing.GroupLayout operationjPanelLayout = new javax.swing.GroupLayout(operationjPanel);
        operationjPanel.setLayout(operationjPanelLayout);
        operationjPanelLayout.setHorizontalGroup(
            operationjPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(operationjPanelLayout.createSequentialGroup()
                .addGap(57, 57, 57)
                .addComponent(parsejButton, javax.swing.GroupLayout.PREFERRED_SIZE, 83, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 151, Short.MAX_VALUE)
                .addComponent(closejButton, javax.swing.GroupLayout.PREFERRED_SIZE, 80, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(137, 137, 137))
        );
        operationjPanelLayout.setVerticalGroup(
            operationjPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(operationjPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(operationjPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(parsejButton)
                    .addComponent(closejButton))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jLayeredPane.add(operationjPanel);
        operationjPanel.setBounds(10, 310, 520, 67);

        dsParseConfjToolBar.setRollover(true);
        dsParseConfjToolBar.setMaximumSize(new java.awt.Dimension(520, 22));
        dsParseConfjToolBar.setMinimumSize(new java.awt.Dimension(520, 22));

        bottomStatusjLabel.setFocusable(false);
        bottomStatusjLabel.setMaximumSize(new java.awt.Dimension(520, 20));
        bottomStatusjLabel.setMinimumSize(new java.awt.Dimension(520, 20));
        bottomStatusjLabel.setName(""); // NOI18N
        dsParseConfjToolBar.add(bottomStatusjLabel);

        jLayeredPane.add(dsParseConfjToolBar);
        dsParseConfjToolBar.setBounds(0, 380, 530, 20);

        allInOnejPanel.setBorder(javax.swing.BorderFactory.createTitledBorder("一次性全转换"));

        allInOnejbuttonGroup.add(allInOneYesjRadioButton);
        allInOneYesjRadioButton.setSelected(true);
        allInOneYesjRadioButton.setText("是");
        allInOneYesjRadioButton.setActionCommand("YES");

        allInOnejbuttonGroup.add(allInOneNojRadioButton);
        allInOneNojRadioButton.setText("否");
        allInOneNojRadioButton.setActionCommand("NO");

        javax.swing.GroupLayout allInOnejPanelLayout = new javax.swing.GroupLayout(allInOnejPanel);
        allInOnejPanel.setLayout(allInOnejPanelLayout);
        allInOnejPanelLayout.setHorizontalGroup(
            allInOnejPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(allInOnejPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(allInOneYesjRadioButton, javax.swing.GroupLayout.PREFERRED_SIZE, 37, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(allInOneNojRadioButton)
                .addContainerGap(410, Short.MAX_VALUE))
        );
        allInOnejPanelLayout.setVerticalGroup(
            allInOnejPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(allInOnejPanelLayout.createSequentialGroup()
                .addGroup(allInOnejPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(allInOneYesjRadioButton)
                    .addComponent(allInOneNojRadioButton))
                .addGap(0, 13, Short.MAX_VALUE))
        );

        jLayeredPane.add(allInOnejPanel);
        allInOnejPanel.setBounds(10, 160, 520, 60);

        filejMenu.setText("文件");

        settingjMenuItem.setText("设置");
        settingjMenuItem.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                settingjMenuItemMouseClicked(evt);
            }
        });
        filejMenu.add(settingjMenuItem);

        jMenuBar.add(filejMenu);

        editjMenu.setText("编辑");
        jMenuBar.add(editjMenu);

        setJMenuBar(jMenuBar);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jLayeredPane, javax.swing.GroupLayout.PREFERRED_SIZE, 535, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jLayeredPane, javax.swing.GroupLayout.PREFERRED_SIZE, 400, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void parsejButtonMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_parsejButtonMouseClicked
        String allInOneFunc = "NO";
        if (funcbuttonGroup.getSelection() != null) {
            allInOneFunc = funcbuttonGroup.getSelection().getActionCommand();
        }

        String msg = "";

        if ("YES".equals(allInOneFunc)) {//全部转换
            //配置文件
            String configFilePath = configFilejTextField.getText();
            //输出路径
            String outputPath = outputjTextField.getText();
            Map<String, String> funcMap = initFuncList();
            for (Entry<String, String> entry : funcMap.entrySet()) {
                String func = entry.getKey();
                String excelFileName = entry.getValue();
                ConfigParserDispatch.transformSingleExcel(func, configFilePath + "/" + excelFileName, outputPath);
            }

        } else {//转换某一个配置项
            String func = "";
            if (funcbuttonGroup.getSelection() != null) {
                func = funcbuttonGroup.getSelection().getActionCommand();
            }

            //配置文件
            String configFilePath = configFilejTextField.getText();
            //输出路径
            String outputPath = outputjTextField.getText();

            if (func.isEmpty()) {
                msg = "请选择解析内容 ";
            } else if (configFilePath.isEmpty()) {
                msg = "请选择待解析文件(xls) ";
            } else if (outputPath.isEmpty()) {
                msg = "请选择输出路径";
            }
            if (!msg.isEmpty()) {
                JOptionPane.showMessageDialog(null, msg, "信息提示", JOptionPane.ERROR_MESSAGE);
                System.exit(0);
            }
            ConfigParserDispatch.transformSingleExcel(func, configFilePath, outputPath);
        }

//        JOptionPane.showMessageDialog(null, "转换成功");
//        this.dispose();
    }//GEN-LAST:event_parsejButtonMouseClicked

    private Map<String, String> initFuncList() {
        Map funcList = new HashMap();
        funcList.put("DS_SHOP_OBJ_ITEM", "shopItem.xls");
        funcList.put("ACTIVITY_LIB", "activityLibraryInfo.xls");
        funcList.put("AVATAR_ITEMS", "avatarItems.xls");
        funcList.put("FEED_INFO", "feedInfo.xls");
        funcList.put("GOODS_ORDER", "goodsOrder.xls");
        funcList.put("REQUEST_INFO", "requestInfo.xls");
        funcList.put("GAME", "game.xls");
        funcList.put("MISSION_INFO", "missionInfo.xls");
        funcList.put("BINDING_RECIPE", "bindingRecipe.xls");
        funcList.put("DESSERT_INFO", "dessertInfo.xls");
        return funcList;
    }

    /**
     * 转换单个excel
     *
     * @param func
     * @param configFilePath
     * @param outputPath
     */
    private void transformSingleExcel(String func, String configFilePath, String outputPath) {
        String msg = "";
        if (func.isEmpty()) {
            msg = "请选择解析内容 ";
        } else if (configFilePath.isEmpty()) {
            msg = "请选择待解析文件(xls) ";
        } else if (outputPath.isEmpty()) {
            msg = "请选择输出路径";
        }
        if (!msg.isEmpty()) {
            JOptionPane.showMessageDialog(null, msg, "信息提示", JOptionPane.ERROR_MESSAGE);
        } else {
            String sheetName = "Worksheet";
            String idField;
            String fileName;
            Map specialField = new HashMap();

            if ("DS_SHOP_OBJ_ITEM".equals(func)) {//shopItem
                transformShopObjectItem(configFilePath, func, outputPath);
            } else if ("ACTIVITY_LIB".equals(func)) {//activityLibraryInfo
                specialField.put("activity_info", "parseCommonMultipleWithKeyValue@4");
                specialField.put("unlockRecipe", "parseCommonMultiple@4");
                fileName = "activityLibraryInfo";
                idField = "id";
                String keys = "activity_type,activity_id";
                String contentSplitFragment = ",!:";
                transformCommonContent(configFilePath, outputPath, fileName, sheetName, idField, specialField, keys, contentSplitFragment);
            } else if ("AVATAR_ITEMS".equals(func)) {//avatarItems
                specialField.put("suite_array", "parseCommonMultiple@3");
                fileName = "avatarItems";
                idField = "item_id";
                transformCommonContent(configFilePath, outputPath, fileName, sheetName, idField, specialField);
            } else if ("FEED_INFO".equals(func)) {//feedInfo
                fileName = "feedInfo";
                idField = "feed_id";
                transformCommonContent(configFilePath, outputPath, fileName, sheetName, idField, specialField);
            } else if ("GOODS_ORDER".equals(func)) {//goodsOrder
                fileName = "goodsOrder";
                idField = "id";
                transformCommonContent(configFilePath, outputPath, fileName, sheetName, idField, specialField);
            } else if ("REQUEST_INFO".equals(func)) {//request_id
                fileName = "requestInfo";
                idField = "request_id";
                transformCommonContent(configFilePath, outputPath, fileName, sheetName, idField, specialField);
            } else if ("GAME".equals(func)) {//game
                fileName = "game";
                specialField.put("randomShelfProductList", "parseCommonMultiple@3");
                specialField.put("rankScoreRewards", "parseGameRankScoreRewards@3");
                transformCommonSingleFileContent(configFilePath, outputPath, fileName, sheetName, specialField);
            } else if ("BINDING_RECIPE".equals(func)) {//bindingRecipe
                specialField.put("recipes", "parseCommonMultiple@4");
                specialField.put("activate_data", "parseBindingRecipeActivateData@3");
                fileName = "bindingRecipe";
                idField = "item_id";
                String keys = "activity_type,activity_id";
                String contentSplitFragment = "|!,";
                transformCommonContent(configFilePath, outputPath, fileName, sheetName, idField, specialField, keys, contentSplitFragment);
            } else if ("MISSION_INFO".equals(func)) {//mission Info  @todo 还有一写文件没有生成
                specialField.put("reward_data", "parseMissionInfoRewardData@3");
                specialField.put("mission_require", "parseMissionInfoMissionRequire@3");
                fileName = "missionInfo";
                idField = "mission_id";
                String keys = "activity_type,activity_id";
                String contentSplitFragment = "|!,";
                Map<String, String[]> combineFields = new HashMap();
                combineFields.put("mission_require", new String[]{"mission_sub_require", "mission_sub_require_desc", "mission_sub_require_tips"});
                transformMissionContent(configFilePath, outputPath, fileName, sheetName, idField, specialField, keys, contentSplitFragment, combineFields);
            } else if ("DESSERT_INFO".equals(func)) {//@todo 需要

            }
        }
    }

    public String[] arrayPop(String[] oldArrayContent) {
        int rows = oldArrayContent.length;
        String[] cleanupedArrayContent = new String[rows - 1];
        for (int row = 0; row < rows - 1; row++) {
            cleanupedArrayContent[row] = oldArrayContent[row + 1];
        }

        return cleanupedArrayContent;
    }

    public String[][] arrayPop(String[][] oldArrayContent) {
        int rows = oldArrayContent.length;
        int cols = oldArrayContent[0].length;
        String[][] cleanupedArrayContent = new String[rows - 1][cols];
        for (int row = 0; row < rows - 1; row++) {
            cleanupedArrayContent[row] = oldArrayContent[row + 1];
        }

        return cleanupedArrayContent;
    }

    public static String arrayImplode(String[] content, String implode) {
        StringBuilder finalStringBuffer = new StringBuilder();
        for (int index = 0; index < content.length; index++) {
            if (index != 0) {
                finalStringBuffer.append(implode);
            }
            finalStringBuffer.append(content[index]);
        }
        return finalStringBuffer.toString();
    }

    public static String[] arrayFilterByIndex(String[] oldArrayContent, String[] indexes) {
        String[] finalData = new String[indexes.length];
        int newIndex = 0;
        for (String index : indexes) {
            finalData[newIndex++] = oldArrayContent[Integer.parseInt(index)];
        }
        return finalData;
    }

    public static String[] arraySlice(String[] oldArrayContent, int startIndex) {
        int length = getMinLength(oldArrayContent, startIndex, -1);
        return arraySlice(oldArrayContent, startIndex, length);
    }

    public static int getMinLength(String[] oldArrayContent, int startIndex, int length) {
        int arrayContentLength = oldArrayContent.length;
        int minLength = 0;
        if (length < 0) {
            minLength = arrayContentLength - startIndex;
        } else if (startIndex > length) {
            minLength = 0;
        } else if (startIndex + length > arrayContentLength) {
            minLength = arrayContentLength;
        } else {
            minLength = startIndex + length;
        }
        return minLength;
    }

    public static String[] arraySlice(String[] oldArrayContent, int startIndex, int length) {
        String[] finalArrayContent = new String[length];
        if (startIndex < 0) {
            startIndex = oldArrayContent.length + startIndex;
        }
        int minLength = getMinLength(oldArrayContent, startIndex, length);
        int index = 0;
        while (startIndex < minLength) {
            finalArrayContent[index++] = oldArrayContent[startIndex++];
        }
        return finalArrayContent;
    }

    public static String[][] itemLangInfoCfg;
    public static String[][] itemBaseInfoCfg;
    public static HashMap<String, HashMap<String, String>> itemIdAndItemName;
    public static HashMap<String, HashMap<String, String>> collectActivityCommonConf;

    public String getItemName(String itemId, String lang) {
        String itemName = "";
        itemIdAndItemName = buildItemIdAndItemName();
        return itemIdAndItemName.get(itemId).get(lang);
    }

    public HashMap buildItemIdAndItemName() {
        HashMap finalInfo = new HashMap();
        HashMap itemNameInfo;
        int rows = itemLangInfoCfg.length;
        for (int rowNum = 1; rowNum < rows; rowNum++) {
            String[] itemNameInfoArray = arraySlice(itemLangInfoCfg[rowNum], 1);
            itemNameInfo = arrayCombine(itemLangs, itemNameInfoArray);
            finalInfo.put(itemLangInfoCfg[rowNum][0], itemNameInfo);
        }
        return finalInfo;
    }

    public HashMap<String, String> arrayCombine(String[] arrayKeys, String[] arrayValues) {
        HashMap<String, String> hashMap = new HashMap<String, String>();
        if (arrayKeys.length == arrayValues.length) {
            for (int i = 0; i < arrayKeys.length; i++) {
                hashMap.put(arrayKeys[i], arrayValues[i]);
            }
        }
        return hashMap;
    }

    public String[] arrayTrim(String[] oldArrayContent) {
        int cols = oldArrayContent.length;
        ArrayList<String> tmpData = new ArrayList<String>();
        for (String tmpContent : oldArrayContent) {
            String trimedContent = tmpContent.trim();
            if (!trimedContent.isEmpty()) {
                tmpData.add(trimedContent);
            }
        }
        return (String[]) tmpData.toArray(new String[tmpData.size()]); // TODO (String[]) tmpData.toArray(); 会报类型转换异常
    }

    public String[][] itemLangInfoCfg(String configFilePath) {
        try {
            int langSheetIndex = getSheetIndexBySheetName(configFilePath, "itemLang");
            itemLangInfoCfg = parseXls(configFilePath, langSheetIndex, true);
        } catch (IOException e) {
            itemLangInfoCfg = new String[0][0];
            showMessageDialogMessage(e);
        } catch (BiffException e) {
            itemLangInfoCfg = new String[0][0];
            showMessageDialogMessage(e);
        }
        return itemLangInfoCfg;
    }

    public String[] getItemLangs(String configFilePath) {
        String langs[];
        try {
            String[][] itemLangCfg = itemLangInfoCfg(configFilePath);
            String[] itemLangModelName = getModelFromStringArray(itemLangCfg);
            langs = arraySlice(itemLangModelName, 1);
        } catch (Exception e) {
            langs = new String[0];
            showMessageDialogMessage(e);
        }
        return langs;
    }

    public static String[] itemLangs;

    public String[] getItemLangFileNames(String configFilePath) {
        Map<String, String> fileNameMap = new HashMap<String, String>();
        fileNameMap.put("Chinese", "zh_tw");
        fileNameMap.put("English", "en_us");
        fileNameMap.put("German", "de_de");
        fileNameMap.put("Dutch", "nl_nl");
        fileNameMap.put("French", "fr_fr");
        fileNameMap.put("GermanSe", "de_se");
        fileNameMap.put("DutchSe", "nl_se");
        fileNameMap.put("FrenchSe", "fr_se");
        fileNameMap.put("Japanese", "ja_jp");

        String langs[] = getItemLangs(configFilePath);
        for (int index = 0; index < langs.length; index++) {
            langs[index] = fileNameMap.get(langs[index]);
        }
        itemLangs = langs;
        return langs;
    }

    public static String getLineInfo() {
        StackTraceElement ste = new Throwable().getStackTrace()[1];
        return ste.getFileName() + ": Line " + ste.getLineNumber();
    }

    /**
     *
     * @return
     */
    public int getDirectoryNameByItemId() {
        int directory = 0;

        return directory;
    }

    public boolean findDuplicateItemId(String[][] content) {
        boolean findDuplicate = false;
        ArrayList itemList = new ArrayList();

        return findDuplicate;
    }

    public static void showErrorMsg(String msg, String title) {
        JOptionPane.showMessageDialog(null, msg, title, JOptionPane.ERROR_MESSAGE, null);
        System.exit(0);
    }

    public static void writeToFile(String contents, String descFile, String encoding) throws FileNotFoundException, IOException {
        File fileOutput = new File(descFile);
        writeToFile(contents, fileOutput, "UTF-8");
    }

    public Map buildSingleRowStr(String[] singleRowInfoContent, Map modelInfo, String lang, Map<String, String> specialField) {
        Map<String, List<Integer>> fieldIndex = (Map<String, List<Integer>>) modelInfo.get("fieldIndex");
        Map<String, List<String>> fieldName = (Map<String, List<String>>) modelInfo.get("fieldName");
        List<Integer> currentFieldIndexList = fieldIndex.get(lang);
        List<String> currentFieldNameList = fieldName.get(lang);
        Integer[] currentFieldIndex = currentFieldIndexList.toArray(new Integer[currentFieldIndexList.size()]);
        String[] currentFieldName = currentFieldNameList.toArray(new String[currentFieldNameList.size()]);
        currentFieldIndexList = null;
        currentFieldNameList = null;
        StringBuilder singleRowStringbuffer = new StringBuilder();
        singleRowStringbuffer.append("array (").append("\r\n");
        for (int i = 0; i < currentFieldIndex.length; i++) {
            int currentIndex = currentFieldIndex[i];
            String currentField = currentFieldName[i];
            String currentFieldContent = singleRowInfoContent[currentIndex];
            if (specialField.containsKey(currentField)) {
                try {
                    String parseFieldFunctionName = specialField.get(currentField);
                    Method parseField = this.getClass().getDeclaredMethod(parseFieldFunctionName, new Class[]{String.class, String.class, String.class});//getMethod 方法 只能获取public 方法
                    parseField.setAccessible(true);
                    singleRowStringbuffer.append(parseField.invoke(this, new Object[]{currentField, currentFieldContent, "    "}));//@todo 精彩的写法
                } catch (IllegalAccessException ex) {
                    System.out.println(ex.getMessage());
                } catch (SecurityException ex) {
                    System.out.println(ex.getMessage());
                } catch (IllegalArgumentException ex) {
                    System.out.println(ex.getMessage());
                } catch (InvocationTargetException ex) {
                    System.out.println(ex.getMessage());
                } catch (NoSuchMethodException ex) {
                    System.out.println(ex.getMessage());
                }
            } else {
                singleRowStringbuffer.append(commonSingleFieldString(currentField, currentFieldContent, "    "));
            }
        }

        singleRowStringbuffer.append(");");

        Map finalInfo = new HashMap();
        finalInfo.put("singleRowInfo", singleRowStringbuffer.toString());
        return finalInfo;
    }

    public Map buildSingleRowStr(String[] singleRowInfoContent, Map modelInfo, String lang, Map<String, String> specialField, String keys) {
        Map<String, List<Integer>> fieldIndex = (Map<String, List<Integer>>) modelInfo.get("fieldIndex");
        Map<String, List<String>> fieldName = (Map<String, List<String>>) modelInfo.get("fieldName");
        List<Integer> currentFieldIndexList = fieldIndex.get(lang);
        List<String> currentFieldNameList = fieldName.get(lang);
        Integer[] currentFieldIndex = currentFieldIndexList.toArray(new Integer[currentFieldIndexList.size()]);
        String[] currentFieldName = currentFieldNameList.toArray(new String[currentFieldNameList.size()]);
        currentFieldIndexList = null;
        currentFieldNameList = null;
        StringBuilder singleRowStringbuffer = new StringBuilder();
        singleRowStringbuffer.append("array (").append("\r\n");
        for (int i = 0; i < currentFieldIndex.length; i++) {
            int currentIndex = currentFieldIndex[i];
            String currentField = currentFieldName[i];
            String currentFieldContent = singleRowInfoContent[currentIndex];
            if (specialField.containsKey(currentField)) {
                try {
                    String parseFieldFunctionName = specialField.get(currentField);
                    Method parseField = this.getClass().getDeclaredMethod(parseFieldFunctionName, new Class[]{String.class, String.class, String.class});//getMethod 方法 只能获取public 方法
                    parseField.setAccessible(true);
                    singleRowStringbuffer.append(parseField.invoke(this, new Object[]{currentField, currentFieldContent, "    "}));//@todo 精彩的写法
                } catch (IllegalAccessException ex) {
                    System.out.println(ex.getMessage());
                } catch (SecurityException ex) {
                    System.out.println(ex.getMessage());
                } catch (IllegalArgumentException ex) {
                    System.out.println(ex.getMessage());
                } catch (InvocationTargetException ex) {
                    System.out.println(ex.getMessage());
                } catch (NoSuchMethodException ex) {
                    System.out.println(ex.getMessage());
                }
            } else {
                singleRowStringbuffer.append(commonSingleFieldString(currentField, currentFieldContent, "    "));
            }
        }

        singleRowStringbuffer.append(");");

        Map finalInfo = new HashMap();
        finalInfo.put("singleRowInfo", singleRowStringbuffer.toString());
        return finalInfo;
    }

    public Map buildSingleRowStr(String[] singleRowInfoContent, Map modelInfo, String lang, int idIndex, String idField, Map<String, String> specialField) {
        Map<String, List<Integer>> fieldIndex = (Map<String, List<Integer>>) modelInfo.get("fieldIndex");
        Map<String, List<String>> fieldName = (Map<String, List<String>>) modelInfo.get("fieldName");
        List<Integer> currentFieldIndexList = fieldIndex.get(lang);
        List<String> currentFieldNameList = fieldName.get(lang);
        Integer[] currentFieldIndex = currentFieldIndexList.toArray(new Integer[currentFieldIndexList.size()]);
        String[] currentFieldName = currentFieldNameList.toArray(new String[currentFieldNameList.size()]);
        currentFieldIndexList = null;
        currentFieldNameList = null;
        StringBuilder singleRowStringbuffer = new StringBuilder();
        StringBuilder allRowsStringbuffer = new StringBuilder();
        String id = singleRowInfoContent[idIndex];
        singleRowStringbuffer.append("array (").append("\r\n");
        allRowsStringbuffer.append("  ").append(id).append(" => \r\n").append("  array (\r\n");
        for (int i = 0; i < currentFieldIndex.length; i++) {
            int currentIndex = currentFieldIndex[i];
            String currentField = currentFieldName[i];
            String currentFieldContent = singleRowInfoContent[currentIndex];
            if (currentField.equals(idField)) {
                id = currentFieldContent;
            }
            if (specialField.containsKey(currentField)) {
                try {
                    String[] parseFieldFunctionInfo = specialField.get(currentField).split("@");
                    String parseFieldFunctionName = parseFieldFunctionInfo[0];
                    int paramCount;
                    if (parseFieldFunctionInfo.length == 1) {
                        paramCount = 3;
                    } else {
                        paramCount = Integer.valueOf(parseFieldFunctionInfo[1]);
                    }

                    List<Class> paramType = new ArrayList();
                    for (int k = 0; k < paramCount; k++) {
                        paramType.add(String.class);
                    }
                    Class clazz[] = paramType.toArray(new Class[]{});
                    Method parseField = this.getClass().getDeclaredMethod(parseFieldFunctionName, clazz);//getMethod 方法 只能获取public 方法
                    parseField.setAccessible(true);
                    singleRowStringbuffer.append(parseField.invoke(this, new Object[]{currentField, currentFieldContent, "    "}));//@todo 精彩的写法
                    allRowsStringbuffer.append(parseField.invoke(this, new Object[]{currentField, currentFieldContent, "  "}));//@todo 精彩的写法
                } catch (IllegalAccessException ex) {
                    System.out.println(ex.getMessage());
                } catch (SecurityException ex) {
                    System.out.println(ex.getMessage());
                } catch (IllegalArgumentException ex) {
                    System.out.println(ex.getMessage());
                } catch (InvocationTargetException ex) {
                    System.out.println(ex.getMessage());
                } catch (NoSuchMethodException ex) {
                    System.out.println(ex.getMessage());
                }
            } else {
                singleRowStringbuffer.append(commonSingleFieldString(currentField, currentFieldContent, "    "));
                allRowsStringbuffer.append(commonSingleFieldString(currentField, currentFieldContent, "  "));
            }
        }

        singleRowStringbuffer.append(");");
        allRowsStringbuffer.append("  ),");

        Map finalInfo = new HashMap();
        finalInfo.put(idField, id);
        finalInfo.put("singleRowInfo", singleRowStringbuffer.toString());
        finalInfo.put("allRowsInfo", allRowsStringbuffer.toString());
        return finalInfo;
    }

    public Map buildMissionSingleRowStr(String[] singleRowInfoContent, Map modelInfo, String lang, int idIndex, String idField, Map<String, String> specialField, String keys, String contentSplitFragment, Map combineFields) {
        Map<String, List<Integer>> fieldIndex = (Map<String, List<Integer>>) modelInfo.get("fieldIndex");
        Map<String, List<String>> fieldName = (Map<String, List<String>>) modelInfo.get("fieldName");
        List<Integer> currentFieldIndexList = fieldIndex.get(lang);
        List<String> currentFieldNameList = fieldName.get(lang);
        Integer[] currentFieldIndex = currentFieldIndexList.toArray(new Integer[currentFieldIndexList.size()]);
        String[] currentFieldName = currentFieldNameList.toArray(new String[currentFieldNameList.size()]);
        currentFieldIndexList = null;
        currentFieldNameList = null;
        StringBuilder singleRowStringbuffer = new StringBuilder();
        StringBuilder allRowsStringbuffer = new StringBuilder();
        String id = singleRowInfoContent[idIndex];
        singleRowStringbuffer.append("array (").append("\r\n");
        allRowsStringbuffer.append("  '").append(id).append("' => \r\n").append("  array (\r\n");
        for (int i = 0; i < currentFieldIndex.length; i++) {
            int currentIndex = currentFieldIndex[i];
            String currentField = currentFieldName[i];
            String currentFieldContent = singleRowInfoContent[currentIndex];
            if (currentField.equals(idField)) {
                id = currentFieldContent;
            }
            if (specialField.containsKey(currentField)) {
                try {
                    String[] parseFieldFunctionInfo = specialField.get(currentField).split("@");
                    String parseFieldFunctionName = parseFieldFunctionInfo[0];
                    int paramCount;
                    if (parseFieldFunctionInfo.length == 1) {
                        paramCount = 4;
                    } else {
                        paramCount = Integer.valueOf(parseFieldFunctionInfo[1]);
                    }

                    List<Class> paramType = new ArrayList();
                    for (int k = 0; k < paramCount; k++) {
                        paramType.add(String.class);
                    }
                    Class clazz[] = paramType.toArray(new Class[]{});
                    Method parseField = this.getClass().getDeclaredMethod(parseFieldFunctionName, clazz);//getMethod 方法 只能获取public 方法
                    parseField.setAccessible(true);
                    //@todo 这一部分可以重构成动态参数的方式 以后在修改
                    if (paramType.size() == 3) {
                        singleRowStringbuffer.append(parseField.invoke(this, new Object[]{currentField, currentFieldContent, "    "}));//@todo 精彩的写法
                        allRowsStringbuffer.append(parseField.invoke(this, new Object[]{currentField, currentFieldContent, "  "}));//@todo 精彩的写法
                    } else if (paramType.size() == 4) {
                        singleRowStringbuffer.append(parseField.invoke(this, new Object[]{currentField, currentFieldContent, "    ", contentSplitFragment}));//@todo 精彩的写法
                        allRowsStringbuffer.append(parseField.invoke(this, new Object[]{currentField, currentFieldContent, "  ", contentSplitFragment}));//@todo 精彩的写法
                    } else if (paramType.size() == 5) {
                        singleRowStringbuffer.append(parseField.invoke(this, new Object[]{currentField, keys, currentFieldContent, "    ", contentSplitFragment}));//@todo 精彩的写法
                        allRowsStringbuffer.append(parseField.invoke(this, new Object[]{currentField, keys, currentFieldContent, "  ", contentSplitFragment}));//@todo 精彩的写法
                    }

                } catch (IllegalAccessException ex) {
                    System.out.println("IllegalAccessException:" + ex.getMessage());
                } catch (SecurityException ex) {
                    System.out.println("SecurityException:" + ex.getMessage());
                } catch (IllegalArgumentException ex) {
                    System.out.println("IllegalArgumentException:" + ex.getMessage());
                } catch (InvocationTargetException ex) {
                    System.out.println("InvocationTargetException:" + ex.getMessage());
                } catch (NoSuchMethodException ex) {
                    System.out.println("NoSuchMethodException:" + ex.getMessage());
                }
            } else {
                singleRowStringbuffer.append(commonSingleFieldString(currentField, currentFieldContent, "    "));
                allRowsStringbuffer.append(commonSingleFieldString(currentField, currentFieldContent, "  "));
            }
        }

        singleRowStringbuffer.append(");");
        allRowsStringbuffer.append("  ),");

        Map finalInfo = new HashMap();
        finalInfo.put(idField, id);
        finalInfo.put("singleRowInfo", singleRowStringbuffer.toString());
        finalInfo.put("allRowsInfo", allRowsStringbuffer.toString());
        return finalInfo;
    }

    public Map buildSingleRowStr(String[] singleRowInfoContent, Map modelInfo, String lang, int idIndex, String idField, Map<String, String> specialField, String keys, String contentSplitFragment) {
        Map<String, List<Integer>> fieldIndex = (Map<String, List<Integer>>) modelInfo.get("fieldIndex");
        Map<String, List<String>> fieldName = (Map<String, List<String>>) modelInfo.get("fieldName");
        List<Integer> currentFieldIndexList = fieldIndex.get(lang);
        List<String> currentFieldNameList = fieldName.get(lang);
        Integer[] currentFieldIndex = currentFieldIndexList.toArray(new Integer[currentFieldIndexList.size()]);
        String[] currentFieldName = currentFieldNameList.toArray(new String[currentFieldNameList.size()]);
        currentFieldIndexList = null;
        currentFieldNameList = null;
        StringBuilder singleRowStringbuffer = new StringBuilder();
        StringBuilder allRowsStringbuffer = new StringBuilder();
        String id = singleRowInfoContent[idIndex];
        singleRowStringbuffer.append("array (").append("\r\n");
        allRowsStringbuffer.append("  ").append(id).append(" => \r\n").append("  array (\r\n");
        for (int i = 0; i < currentFieldIndex.length; i++) {
            int currentIndex = currentFieldIndex[i];
            String currentField = currentFieldName[i];
            String currentFieldContent = singleRowInfoContent[currentIndex];
            if (currentField.equals(idField)) {
                id = currentFieldContent;
            }
            if (specialField.containsKey(currentField)) {
                try {
                    String[] parseFieldFunctionInfo = specialField.get(currentField).split("@");
                    String parseFieldFunctionName = parseFieldFunctionInfo[0];
                    int paramCount;
                    if (parseFieldFunctionInfo.length == 1) {
                        paramCount = 4;
                    } else {
                        paramCount = Integer.valueOf(parseFieldFunctionInfo[1]);
                    }

                    List<Class> paramType = new ArrayList();
                    for (int k = 0; k < paramCount; k++) {
                        paramType.add(String.class);
                    }
                    Class clazz[] = paramType.toArray(new Class[]{});
                    Method parseField = this.getClass().getDeclaredMethod(parseFieldFunctionName, clazz);//getMethod 方法 只能获取public 方法
                    parseField.setAccessible(true);
                    //@todo 这一部分可以重构成动态参数的方式 以后在修改
                    if (paramType.size() == 3) {
                        singleRowStringbuffer.append(parseField.invoke(this, new Object[]{currentField, currentFieldContent, "    "}));//@todo 精彩的写法
                        allRowsStringbuffer.append(parseField.invoke(this, new Object[]{currentField, currentFieldContent, "  "}));//@todo 精彩的写法
                    } else if (paramType.size() == 4) {
                        singleRowStringbuffer.append(parseField.invoke(this, new Object[]{currentField, currentFieldContent, "    ", contentSplitFragment}));//@todo 精彩的写法
                        allRowsStringbuffer.append(parseField.invoke(this, new Object[]{currentField, currentFieldContent, "  ", contentSplitFragment}));//@todo 精彩的写法
                    } else if (paramType.size() == 5) {
                        singleRowStringbuffer.append(parseField.invoke(this, new Object[]{currentField, keys, currentFieldContent, "    ", contentSplitFragment}));//@todo 精彩的写法
                        allRowsStringbuffer.append(parseField.invoke(this, new Object[]{currentField, keys, currentFieldContent, "  ", contentSplitFragment}));//@todo 精彩的写法
                    }

                } catch (IllegalAccessException ex) {
                    System.out.println("IllegalAccessException:" + ex.getMessage());
                } catch (SecurityException ex) {
                    System.out.println("SecurityException:" + ex.getMessage());
                } catch (IllegalArgumentException ex) {
                    System.out.println("IllegalArgumentException:" + ex.getMessage());
                } catch (InvocationTargetException ex) {
                    System.out.println("InvocationTargetException:" + ex.getMessage());
                } catch (NoSuchMethodException ex) {
                    System.out.println("NoSuchMethodException:" + ex.getMessage());
                }
            } else {
                singleRowStringbuffer.append(commonSingleFieldString(currentField, currentFieldContent, "    "));
                allRowsStringbuffer.append(commonSingleFieldString(currentField, currentFieldContent, "  "));
            }
        }

        singleRowStringbuffer.append(");");
        allRowsStringbuffer.append("  ),");

        Map finalInfo = new HashMap();
        finalInfo.put(idField, id);
        finalInfo.put("singleRowInfo", singleRowStringbuffer.toString());
        finalInfo.put("allRowsInfo", allRowsStringbuffer.toString());
        return finalInfo;
    }

    private String parseActivityInfo(String field, String content, String leadingString) {
        content = content.replaceAll("<br>", "\r\n");//将<br>替换为\r\n '11:6,2:31
        String[] contentArray = content.split(",");
        StringBuilder tmpContent = new StringBuilder();
        int index = 0;
        String tpl = leadingString + "%d => \n"
                + leadingString + "array (\n"
                + leadingString + "  'activity_type' => '%d',\n"
                + leadingString + "  'activity_id' => '%d',\n"
                + leadingString + "),";
        for (String currentContent : contentArray) {
            String[] contentFactor = currentContent.split(":");
            if (contentFactor.length == 2) {
                tmpContent.append(String.format(tpl, index++, contentFactor[0], contentFactor[1]));
            }
        }
        return tmpContent.toString();
    }

    /**
     * 将 "a","b","c" 转换为 array( "a","b","c")
     *
     * @param field
     * @param content
     * @param leadingString
     * @return
     */
    private String parseCommonMultiple(String field, String content, String leadingString) {
        content = content.replaceAll("<br>", "\r\n");//将<br>替换为\r\n '11:6,2:31
        String[] contentArray = content.split(",");
        StringBuilder tmpContent = new StringBuilder();
        tmpContent.append(leadingString).append("'").append(field).append("' => ");
        if (!content.isEmpty()) {
            tmpContent.append("array(");
            int index = 0;
            for (String currentContent : contentArray) {
                tmpContent.append(index++).append(" => '").append(currentContent).append("',");
            }
            tmpContent.append(")");
        } else {
            tmpContent.append("NULL");
        }
        tmpContent.append(",\r\n");

        return tmpContent.toString();
    }

    /**
     * 将 "a","b","c" 转换为 array( "a","b","c")
     *
     * @param field
     * @param content
     * 161:49501:4:0,162:49502:4:0,215:50501:5:1,218:50502:5:1|163:49503:4:0,164:49504:4:0,221:50503:5:1,224:50504:5:1|165:49505:4:0,166:49506:4:0,227:50505:5:1,230:50506:5:1
     * @param leadingString
     * @return
     */
    private String parseBindingRecipeActivateData(String field, String content, String leadingString) {
        content = content.replaceAll("<br>", "\r\n");//将<br>替换为\r\n '11:6,2:31
        String[] contentArray = content.split("\\|");//第一层
        StringBuilder tmpContent = new StringBuilder();
        tmpContent.append(leadingString).append("'").append(field).append("' => ");
        if (!content.isEmpty()) {
            tmpContent.append("array(\r\n");
            int firstFoolrIndex = 0;
            for (String currentContent : contentArray) {
                int secondFoolrIndex = 0;
                if (!currentContent.isEmpty()) {
                    String[] currentContentArray = currentContent.split(",");//第二层
                    tmpContent.append(leadingString).append(leadingString).append(firstFoolrIndex).append(" => array(\r\n");
                    for (String currentItem : currentContentArray) {
                        if (!currentItem.isEmpty()) {
                            String[] singleFactors = currentItem.split(":");//第三层
                            tmpContent.append(leadingString).append(leadingString).append(leadingString).append(secondFoolrIndex).append(" => array(\r\n");//),\r\n
                            tmpContent.append(leadingString).append(leadingString).append(leadingString).append(leadingString).append(leadingString).append("'activate_id' => '").append(singleFactors[0]).append("',\r\n");
                            tmpContent.append(leadingString).append(leadingString).append(leadingString).append(leadingString).append(leadingString).append("'activate_item_id' => '").append(singleFactors[1]).append("',\r\n");
                            tmpContent.append(leadingString).append(leadingString).append(leadingString).append(leadingString).append(leadingString).append("'activate_num' => '").append(singleFactors[2]).append("',\r\n");
                            tmpContent.append(leadingString).append(leadingString).append(leadingString).append(leadingString).append(leadingString).append("'activate_type' => '").append(singleFactors[3]).append("',\r\n");
                            tmpContent.append(leadingString).append(leadingString).append(leadingString).append("),\r\n");//
                        } else {//第二层
                            tmpContent.append(leadingString).append(leadingString).append(leadingString).append(secondFoolrIndex).append(" => array(),\r\n");
                        }
                        secondFoolrIndex++;
                    }
                    tmpContent.append(leadingString).append(leadingString).append("),\r\n");
                } else {
                    tmpContent.append(leadingString).append(leadingString).append(firstFoolrIndex).append(" => array(),\r\n");
                }
                firstFoolrIndex++;
            }
            tmpContent.append(")");
        } else {
            tmpContent.append("NULL");
        }
        tmpContent.append(",\r\n");

        return tmpContent.toString();
    }

    private String parseMissionInfoRewardData(String field, String content, String leadingString) {
        content = content.replaceAll("<br>", "\r\n");//将<br>替换为\r\n '11:6,2:31
        String[] contentArray = content.split(",");//第一层
        StringBuilder tmpContent = new StringBuilder();
        tmpContent.append(leadingString).append("'").append(field).append("' => ");
        String leadingString2 = leadingString + leadingString;
        String leadingString3 = leadingString + leadingString + leadingString;
        String secondFloorContentFormat = "%s => array (\r\n"
                + "%s'reward_index' => '%s',\r\n"
                + "%s'reward_item_type' => '%s',\r\n"
                + "%s'reward_item_id' => '%s',\r\n"
                + "%s'reward_item_num' => '%s',\r\n"
                + "%s),\r\n";
        if (!content.isEmpty()) {
            tmpContent.append("array(\r\n");
            int firstFoolrIndex = 0;
            for (String currentFirstFloorContent : contentArray) {
                if (!currentFirstFloorContent.isEmpty()) {
                    String[] currentSecondFloorContentArray = currentFirstFloorContent.split(":");//第二层
                    tmpContent.append(leadingString).append(leadingString).append(firstFoolrIndex).append(String.format(secondFloorContentFormat, leadingString2, leadingString3, currentSecondFloorContentArray[0], leadingString3, currentSecondFloorContentArray[1], leadingString3, currentSecondFloorContentArray[2], leadingString3, currentSecondFloorContentArray[3], leadingString2));
                } else {
                    tmpContent.append(leadingString).append(leadingString).append(firstFoolrIndex).append(" => array(),\r\n");
                }
                firstFoolrIndex++;
            }
            tmpContent.append(")");
        } else {
            tmpContent.append("NULL");
        }
        tmpContent.append(",\r\n");

        return tmpContent.toString();
    }

    private String parseMissionInfoMissionRequire(String field, String content, String leadingString) {
        content = content.replaceAll("<br>", "\r\n");//将<br>替换为\r\n '11:6,2:31   //fck 这个太恶心了，  content 只有9项内容，其他的内容再另一个content中，且 还需要进行分割。。。 坑爹啊。。
        String[] contentArray = content.split(MISSION_REQUIRE_FIRST_FLOOR);//第一层
        StringBuilder tmpContent = new StringBuilder();
        tmpContent.append(leadingString).append("'").append(field).append("' => ");
        String leadingString2 = leadingString + leadingString;
        String leadingString3 = leadingString + leadingString + leadingString;
        String secondFloorContentFormat = "%s%d => array (\r\n"
                + "%s'require_index' => '%s',\r\n"
                + "%s'mission_require_icon' => '%s',\r\n"
                + "%s'mission_require_type' => '%s',\r\n"
                + "%s'require_item_id' => '%s',\r\n"
                + "%s'require_item_num' => '%s',\r\n"
                + "%s'require_type' => '%s',\r\n"
                + "%s'require_id' => '%s',\r\n"
                + "%s'is_skippable' => '%s',\r\n"
                + "%s'require_skip_cash' => '%s',\r\n"
                + "%s'mission_sub_require' => '%s',\r\n"
                + "%s'mission_sub_require_desc' => '%s',\r\n"
                + "%s'mission_sub_require_tips' => '%s',\r\n"
                + "%s),\r\n";
        if (!content.isEmpty()) {
            tmpContent.append("array(\r\n");
            int firstFoolrIndex = 0;
            for (String currentFirstFloorContent : contentArray) {
                if (!currentFirstFloorContent.isEmpty()) {
                    String[] currentSecondFloorContentArray = currentFirstFloorContent.split(MISSION_REQUIRE_SECOND_FLOOR);//第二层
                    tmpContent.append(leadingString).append(leadingString)
                            .append(String.format(secondFloorContentFormat, leadingString2, firstFoolrIndex,
                                            leadingString3, currentSecondFloorContentArray[0],
                                            leadingString3, currentSecondFloorContentArray[1],
                                            leadingString3, currentSecondFloorContentArray[2],
                                            leadingString3, currentSecondFloorContentArray[3],
                                            leadingString3, currentSecondFloorContentArray[4],
                                            leadingString3, currentSecondFloorContentArray[5],
                                            leadingString3, currentSecondFloorContentArray[6],
                                            leadingString3, currentSecondFloorContentArray[7],
                                            leadingString3, currentSecondFloorContentArray[8],
                                            leadingString3, currentSecondFloorContentArray[9],
                                            leadingString3, currentSecondFloorContentArray[10],
                                            leadingString3, currentSecondFloorContentArray[11],
                                            leadingString2));
                } else {
                    tmpContent.append(leadingString).append(leadingString).append(firstFoolrIndex).append(" => array(),\r\n");
                }
                firstFoolrIndex++;
            }
            tmpContent.append(")");
        } else {
            tmpContent.append("NULL");
        }
        tmpContent.append(",\r\n");

        return tmpContent.toString();
    }
    private static final String MISSION_REQUIRE_SECOND_FLOOR = "!@@@@!";
    private static final String MISSION_REQUIRE_FIRST_FLOOR = "-##-";

    /**
     * 将 "a","b","c" 转换为 array( "a","b","c")
     *
     * @param field
     * @param content
     * @param leadingString
     * @return
     */
    private String parseCommonMultiple(String field, String content, String leadingString, String contentSplitFragment) {
        content = content.replaceAll("<br>", "\r\n");//将<br>替换为\r\n '11:6,2:31
        String[] contentSplitFragmentArray = contentSplitFragment.split("!");
        StringBuilder tmpContent = new StringBuilder();
        tmpContent.append(leadingString).append("'").append(field).append("' => array(\r\n");
        //分隔内容
        String firstSplitFragment, secondSplitFragment, thirdSplitFragment, fourthSplitFragment;
        String[] firstContentArray, secondContentArray, thirdContentArray, fourthContentArray;
        int firstIndex = 0, secondIndex = 0, thirdIndex = 0, fourthIndex = 0;
        switch (contentSplitFragmentArray.length) {
            case 1:
                firstSplitFragment = contentSplitFragmentArray[0];
                firstContentArray = content.split("\\" + firstSplitFragment);
                for (String firstContentFragement : firstContentArray) {
                    tmpContent.append(leadingString).append(leadingString).append(firstIndex++).append(" => '").append(firstContentFragement).append("',\r\n");
                }
                break;
            case 2:
                firstSplitFragment = contentSplitFragmentArray[0];
                secondSplitFragment = contentSplitFragmentArray[1];
                firstContentArray = content.split("\\" + firstSplitFragment);
                for (String firstContentFragement : firstContentArray) {
                    secondIndex = 0;
                    thirdIndex = 0;
                    fourthIndex = 0;
                    if (!firstContentFragement.isEmpty()) {
                        tmpContent.append(leadingString).append(leadingString).append(firstIndex++).append(" => array(\r\n");
                        secondContentArray = firstContentFragement.split("\\" + secondSplitFragment);
                        for (String secondContentFragement : secondContentArray) {
                            tmpContent.append(leadingString).append(leadingString).append(leadingString).append(secondIndex++).append(" => '").append(secondContentFragement).append("',\r\n");
                        }
                        tmpContent.append(leadingString).append(leadingString).append("),\r\n");
                    } else {
                        tmpContent.append(leadingString).append(leadingString).append(firstIndex++).append(" => array(),\r\n");
                    }
                }
                break;
            case 3:
                firstSplitFragment = contentSplitFragmentArray[0];
                secondSplitFragment = contentSplitFragmentArray[1];
                thirdSplitFragment = contentSplitFragmentArray[2];
                firstContentArray = content.split("\\" + firstSplitFragment);
                for (String firstContentFragement : firstContentArray) {
                    secondIndex = 0;
                    thirdIndex = 0;
                    fourthIndex = 0;
                    if (!firstContentFragement.isEmpty()) {
                        tmpContent.append(leadingString).append(leadingString).append(firstIndex++).append(" => array(\r\n");
                        secondContentArray = firstContentFragement.split("\\" + secondSplitFragment);
                        for (String secondContentFragement : secondContentArray) {
                            if (!secondContentFragement.isEmpty()) {
                                tmpContent.append(leadingString).append(leadingString).append(leadingString).append(secondIndex++).append(" => array(\r\n");
                                thirdContentArray = secondContentFragement.split("\\" + thirdSplitFragment);
                                for (String thirdContentFragement : thirdContentArray) {
                                    tmpContent.append(leadingString).append(leadingString).append(leadingString).append(leadingString).append(thirdIndex++).append(" => '").append(thirdContentFragement).append("',\r\n");
                                }
                                tmpContent.append(leadingString).append(leadingString).append(leadingString).append("),\r\n");
                            } else {
                                tmpContent.append(leadingString).append(leadingString).append(leadingString).append(secondIndex++).append(" => array(),\r\n");
                            }
                            //tmpContent.append(leadingString).append(leadingString).append(leadingString).append(secondIndex++).append(" => '").append(secondContentFragement).append("',\r\n");
                        }
                        tmpContent.append(leadingString).append(leadingString).append("),\r\n");
                    } else {
                        tmpContent.append(leadingString).append(leadingString).append(firstIndex++).append(" => array(),\r\n");
                    }
                }
                break;
            case 4:
                break;
            default://这么负载
        }

        tmpContent.append(leadingString).append("),\r\n");
        return tmpContent.toString();
    }

    private String parseGameRankScoreRewards(String field, String content, String leadingString) {

        String rewardStringFormat = "array('itemId' => %s, 'itemNum' => %s),";
        //500|1:5,56004:50,56001:5000;
        String[] singleRankScore = content.split(";");
        String test = leadingString + "'" + field + "' => array(\r\n";
        for (int i = 0; i < singleRankScore.length; i++) {
            String currentSingleRankScore = singleRankScore[i];
            if (!currentSingleRankScore.isEmpty()) {
                String[] singleRankScoreItem = currentSingleRankScore.split("\\|");
                test += leadingString + leadingString + "array(\r\n";
                test += leadingString + leadingString + leadingString + "'score' => " + singleRankScoreItem[0] + ",\r\n";
                test += leadingString + leadingString + leadingString + "'reward' => array(\r\n";
                String currentSingleRankScoreItem = singleRankScoreItem[1];
                if (!currentSingleRankScoreItem.isEmpty()) {
                    String[] singleRankScoreItemReward = currentSingleRankScoreItem.split(",");
                    for (int j = 0; j < singleRankScoreItemReward.length; j++) {
                        String currentSingleRankScoreItemReward = singleRankScoreItemReward[j];
                        if (!currentSingleRankScoreItemReward.isEmpty()) {
                            String[] singleRankScoreItemRewardItem = currentSingleRankScoreItemReward.split(":");
                            test += leadingString + leadingString + leadingString + leadingString + String.format(rewardStringFormat, singleRankScoreItemRewardItem[0], singleRankScoreItemRewardItem[1]) + "\r\n";
                        }
                    }
                }
            }
            test += leadingString + leadingString + leadingString + "),\r\n";
            test += leadingString + "),\r\n";
        }

//        content = content.replaceAll("<br>", "\r\n");//将<br>替换为\r\n '11:6,2:31
//        String[] contentArray = content.split(",");
//        StringBuilder tmpContent = new StringBuilder();
//        tmpContent.append(leadingString).append("'").append(field).append("' => ");
//        if (!content.isEmpty()) {
//            tmpContent.append("array(");
//            for (String currentContent : contentArray) {
//                tmpContent.append("'").append(currentContent).append("',");
//            }
//            tmpContent.append(")");
//        } else {
//            tmpContent.append("NULL");
//        }
//        tmpContent.append(",\r\n");
        test += leadingString + "),";
        return test;
    }

    /**
     * 将 1:12,2:22,3:33 转换为 array ( 0 => array('key' => 1,'value' => 12), 1 =>
     * array('key' => 2,'value' => 22), 2 => array('key' => 3,'value' => 33), )
     *
     * @param field
     * @param content
     * @param leadingString
     * @return
     */
    private String parseCommonMultipleWithKeyValue(String field, String keys, String content, String leadingString) {
        content = content.replaceAll("<br>", "\r\n");//将<br>替换为\r\n '11:6,2:31
        String[] contentArray = content.split(",");
        StringBuilder tmpContent = new StringBuilder();
        tmpContent.append(leadingString).append("'").append(field).append("' => ");
        if (!content.isEmpty()) {
            tmpContent.append("array(");
            String[] keyArray = keys.split(",");
            for (String currentContent : contentArray) {
                String[] contentFactor = currentContent.split(":");
                tmpContent.append(leadingString).append(leadingString).append("array(");
                if (contentFactor.length == keyArray.length) {
                    for (int i = 0; i < keyArray.length; i++) {
                        tmpContent.append(String.format("'%s' => '%s',", keyArray[i], contentFactor[i]));
                    }
                }
                tmpContent.append("),");
            }
            tmpContent.append(")");
        }
        tmpContent.append(",\r\n");
        return tmpContent.toString();
    }

    public String commonSingleFieldString(String field, String content, String leadingString) {
        content = content.replaceAll("<br>", "\r\n");//将<br>替换为\r\n
        String contentFormat = "'%s' => '%s',\r\n";
        return leadingString + String.format(contentFormat, field, content);
    }

    public Map buildSingleItemStr(String[] itemBaseInfoContent, Map modelInfo, String lang, int itemIdIndex) {
        Map<String, List<Integer>> fieldIndex = (Map<String, List<Integer>>) modelInfo.get("fieldIndex");
        Map<String, List<String>> fieldName = (Map<String, List<String>>) modelInfo.get("fieldName");
        List<Integer> currentFieldIndexList = fieldIndex.get(lang);
        List<String> currentFieldNameList = fieldName.get(lang);
        Integer[] currentFieldIndex = currentFieldIndexList.toArray(new Integer[currentFieldIndexList.size()]);
        String[] currentFieldName = currentFieldNameList.toArray(new String[currentFieldNameList.size()]);
        currentFieldIndexList = null;
        currentFieldNameList = null;
        StringBuilder singleItemStringbuffer = new StringBuilder();
        StringBuilder allItemsStringbuffer = new StringBuilder();
        String itemId = itemBaseInfoContent[itemIdIndex];
        singleItemStringbuffer.append("array (").append("\r\n");
        allItemsStringbuffer.append("  ").append(itemId).append(" => \r\n").append("  array (\r\n");
        for (int i = 0; i < currentFieldIndex.length; i++) {
            int currentIndex = currentFieldIndex[i];
            String currentField = currentFieldName[i];
            String currentFieldContent = itemBaseInfoContent[currentIndex];
            if (currentField.equals("item_id")) {
                itemId = currentFieldContent;
            }
            currentFieldContent = currentFieldContent.replaceAll("<br>", "\r\n");//将<br>替换为\r\n
            singleItemStringbuffer.append("  '");
            singleItemStringbuffer.append(currentField);
            singleItemStringbuffer.append("'");
            singleItemStringbuffer.append("=>");
            singleItemStringbuffer.append("'");
            singleItemStringbuffer.append(currentFieldContent);
            singleItemStringbuffer.append("'");
            singleItemStringbuffer.append(",");
            singleItemStringbuffer.append("\r\n");

            allItemsStringbuffer.append("    '");
            allItemsStringbuffer.append(currentField);
            allItemsStringbuffer.append("'");
            allItemsStringbuffer.append("=>");
            allItemsStringbuffer.append("'");
            allItemsStringbuffer.append(currentFieldContent);
            allItemsStringbuffer.append("'");
            allItemsStringbuffer.append(",");
            allItemsStringbuffer.append("\r\n");
        }

        singleItemStringbuffer.append(");");
        allItemsStringbuffer.append("  ),");

        Map finalInfo = new HashMap();
        finalInfo.put("itemId", itemId);
        finalInfo.put("singleItemInfo", singleItemStringbuffer.toString());
        finalInfo.put("allItemInfo", allItemsStringbuffer.toString());
        return finalInfo;
    }

    public String buildSingleRowStoredPath(String lang, String itemId, String outputPath, String dirName, String fileName) {
        return outputPath + "/" + lang + "/" + dirName + "/" + fileName + itemId + ".php";
    }

    public String buildSingleRowStoredPath(String lang, String itemId, String outputPath, String fileName) {
        return outputPath + "/" + lang + "/" + fileName + itemId + ".php";
    }

    public String buildSingleItemStoredPath(String lang, String itemId, String outputPath) {
        return outputPath + "/" + lang + "/objItem/objItem" + itemId + ".php";
    }

    public void transformFinish(String message) {
        JOptionPane.showMessageDialog(null, message);
        this.dispose();
    }

    public static int getFieldIndexByFieldName(List<String> fileNameList, List<Integer> fileIndexList, String fieldName) {
        int finalIndex = -1;
        int len = fileNameList.size();
        for (int i = 0; i < len; i++) {
            if (fileNameList.get(i).equals(fieldName)) {
                finalIndex = fileIndexList.get(i);
                break;
            }
        }
        return finalIndex;
    }

    public static int getFieldIndexByFieldName(List<String> modelInfo, String fieldName) {
        int finalIndex = -1;
        int len = modelInfo.size();
        for (int i = 0; i < len; i++) {
            if (modelInfo.get(i).equals(fieldName)) {
                finalIndex = i;
                break;
            }
        }
        return finalIndex;
    }

    /**
     * 甜品店 shop object item
     *
     * @param configFilePath
     * @param func
     * @param outputPath
     */
    public void transformShopObjectItem(final String configFilePath, String func, final String outputPath) {
        JOptionPane.showMessageDialog(null, "转换开始");
        final long startTime = System.currentTimeMillis();
        final List<Thread> threadList = new ArrayList();
        final DessertShopConfigParseJFrame currentUIObject = this;
        Thread thread = new Thread(new Runnable() {
            @Override
            public void run() {
                try {
                    int sheetIndex = getSheetIndexBySheetName(configFilePath, "Worksheet");
                    final String[][] dsOpengraphCfg = parseXls(configFilePath, sheetIndex, true);

                    final Map<String, Map<String, List<String>>> modelInfo = getModel(dsOpengraphCfg[0]);
                    String[] langList = getLangs();

                    for (final String currentLang : langList) {
                        // start single lang 
                        Thread currentThread = new Thread(new Runnable() {
                            @Override
                            public void run() {
                                int itemIdIndex = DessertShopConfigParseJFrame.getFieldIndexByFieldName(modelInfo.get("fieldName").get(currentLang), "item_id");
                                StringBuilder allItemInfo = new StringBuilder();
                                allItemInfo.append(" return array (\r\n");
                                for (int i = 1; i < dsOpengraphCfg.length; i++) {
                                    Map<String, String> singleRowInfo = buildSingleItemStr(dsOpengraphCfg[i], modelInfo, currentLang, itemIdIndex);
                                    String itemId = singleRowInfo.get("itemId");
                                    String singleItemInfo = singleRowInfo.get("singleItemInfo");
                                    String currentAllItemInfo = singleRowInfo.get("allItemInfo");
                                    String descFile = buildSingleItemStoredPath(currentLang, itemId, outputPath);
                                    try {
                                        writeToFile("<?php\r\n return " + singleItemInfo, descFile, "UTF-8");
                                    } catch (FileNotFoundException ex) {
                                        Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                                    } catch (IOException ex) {
                                        Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                                    }
                                    if (i == 1) {//第一行 没有必要添加\r\n
                                        allItemInfo.append(currentAllItemInfo);
                                    } else {
                                        allItemInfo.append("\r\n").append(currentAllItemInfo);
                                    }
                                    bottomStatusjLabel.setText("语言：" + currentLang + "完成度:" + (i * 100 / dsOpengraphCfg.length) + "%|正在生成文件:" + outputPath);
                                }
                                try {
                                    bottomStatusjLabel.setText("语言：" + currentLang + "完成度:" + "100%|正在生成文件:" + outputPath);
                                    String descFile = buildSingleItemStoredPath(currentLang, "", outputPath);
                                    writeToFile("<?php\r\n" + allItemInfo.toString() + "\r\n);", descFile, "UTF-8");
                                } catch (FileNotFoundException ex) {
                                    Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                                } catch (IOException ex) {
                                    Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                                }
                            }
                        });
                        currentThread.start();
                        threadList.add(currentThread);
                        //end single lang
                    }

                    boolean allThreadFinished;
                    do {
                        allThreadFinished = false;
                        try {
                            for (Thread t : threadList) {
                                if (t.getState() != Thread.State.TERMINATED) {
                                    allThreadFinished = false;
                                    break;
                                } else {
                                    allThreadFinished = true;
                                }
                            }
                            Thread.sleep(1000);//停止1s再坚持
                        } catch (InterruptedException ex) {
                            Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                        }
                    } while (!allThreadFinished);//
                    long endTime = System.currentTimeMillis();
                    long diff = endTime - startTime;
                    bottomStatusjLabel.setText("转换完成。耗时:" + DessertShopConfigParseJFrame.formatTimeDuration(diff));
                    currentUIObject.transformFinish("完成转换!");
                } catch (IOException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class
                            .getName()).log(Level.SEVERE, null, ex);
                    showMessageDialogMessage(ex);
                } catch (BiffException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class
                            .getName()).log(Level.SEVERE, null, ex);
                    showMessageDialogMessage(ex);
                }
            }
        });
        thread.start();
    }

    /**
     * 甜品店 活动库
     *
     * @param configFilePath
     * @param func
     * @param outputPath
     */
    public void transformActivityLib(final String configFilePath, String func, final String outputPath) {
        JOptionPane.showMessageDialog(null, "转换开始");
        final long startTime = System.currentTimeMillis();
        final List<Thread> threadList = new ArrayList();
        final DessertShopConfigParseJFrame currentUIObject = this;
        Thread thread = new Thread(new Runnable() {
            @Override
            public void run() {
                try {
                    int sheetIndex = getSheetIndexBySheetName(configFilePath, "Worksheet");
                    final String[][] activityLibCfg = parseXls(configFilePath, sheetIndex, true);

                    final Map<String, Map<String, List<String>>> modelInfo = getModel(activityLibCfg[0]);
                    String[] langList = getLangs();

                    for (final String currentLang : langList) {
                        // start single lang 
                        Thread currentThread = new Thread(new Runnable() {
                            @Override
                            public void run() {
                                int activityIdIndex = DessertShopConfigParseJFrame.getFieldIndexByFieldName(modelInfo.get("fieldName").get(currentLang), "id");
                                StringBuilder allActivityInfo = new StringBuilder();
                                allActivityInfo.append(" return array (\r\n");
                                Map<String, String> specialField = new HashMap();
                                String idField = "id";

                                specialField.put("activity_info", "parseActivityInfo");
                                for (int i = 1; i < activityLibCfg.length; i++) {
                                    Map<String, String> singleRowInfo = buildSingleRowStr(activityLibCfg[i], modelInfo, currentLang, activityIdIndex, idField, specialField);
                                    String id = singleRowInfo.get(idField);
                                    String singleItemInfo = singleRowInfo.get("singleRowInfo");
                                    String currentAllItemInfo = singleRowInfo.get("allRowsInfo");
                                    String descFile = buildSingleRowStoredPath(currentLang, id, outputPath, "activityLibraryInfo", "activityLibraryInfo");
                                    try {
                                        writeToFile("<?php\r\n" + singleItemInfo, descFile, "UTF-8");
                                    } catch (FileNotFoundException ex) {
                                        Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                                    } catch (IOException ex) {
                                        Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                                    }
                                    if (i == 1) {//第一行 没有必要添加\r\n
                                        allActivityInfo.append(currentAllItemInfo);
                                    } else {
                                        allActivityInfo.append("\r\n").append(currentAllItemInfo);
                                    }
                                    bottomStatusjLabel.setText("语言：" + currentLang + "完成度:" + (i * 100 / activityLibCfg.length) + "%|正在生成文件:" + outputPath);
                                }
                                try {
                                    bottomStatusjLabel.setText("语言：" + currentLang + "完成度:" + "100%|正在生成文件:" + outputPath);
                                    String descFile = buildSingleRowStoredPath(currentLang, "", outputPath, "activityLibraryInfo", "activityLibraryInfo");
                                    writeToFile("<?php\r\n" + allActivityInfo.toString(), descFile, "UTF-8");
                                } catch (FileNotFoundException ex) {
                                    Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                                } catch (IOException ex) {
                                    Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                                }
                            }
                        });
                        currentThread.start();
                        threadList.add(currentThread);
                        //end single lang
                    }

                    boolean allThreadFinished;
                    do {
                        allThreadFinished = false;
                        try {
                            for (Thread t : threadList) {
                                if (t.getState() != Thread.State.TERMINATED) {
                                    allThreadFinished = false;
                                    break;
                                } else {
                                    allThreadFinished = true;
                                }
                            }
                            Thread.sleep(1000);//停止1s再坚持
                        } catch (InterruptedException ex) {
                            Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                        }
                    } while (!allThreadFinished);//
                    long endTime = System.currentTimeMillis();
                    long diff = endTime - startTime;
                    bottomStatusjLabel.setText("转换完成。耗时:" + DessertShopConfigParseJFrame.formatTimeDuration(diff));
                    currentUIObject.transformFinish("完成转换!");
                } catch (IOException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class
                            .getName()).log(Level.SEVERE, null, ex);
                    showMessageDialogMessage(ex);
                } catch (BiffException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class
                            .getName()).log(Level.SEVERE, null, ex);
                    showMessageDialogMessage(ex);
                }
            }
        });
        thread.start();
    }

    /**
     * 通用
     *
     * @param configFilePath
     * @param outputPath
     * @param fileName
     * @param sheetName
     * @param idField
     * @param specialField
     */
    public void transformCommonContent(final String configFilePath, final String outputPath, final String fileName, final String sheetName, final String idField, final Map specialField) {
        final long startTime = System.currentTimeMillis();
        final List<Thread> threadList = new ArrayList();
        final DessertShopConfigParseJFrame currentUIObject = this;

        new Thread(new Runnable() {
            @Override
            public void run() {
                try {
                    int sheetIndex = getSheetIndexBySheetName(configFilePath, sheetName);
                    final String[][] commonContent = parseXls(configFilePath, sheetIndex, true);

                    final Map<String, Map<String, List<String>>> modelInfo = getModel(commonContent[0]);
                    String[] langList = getLangs();

                    for (final String currentLang : langList) {
                        // start single lang 
                        Thread currentThread = transformCommonThread(currentLang, outputPath, fileName, modelInfo, commonContent, idField, specialField);
                        currentThread.start();
                        threadList.add(currentThread);
                        //end single lang
                    }

                    boolean allThreadFinished;
                    do {
                        allThreadFinished = false;
                        try {
                            for (Thread t : threadList) {
                                if (t.getState() != Thread.State.TERMINATED) {
                                    allThreadFinished = false;
                                    break;
                                } else {
                                    allThreadFinished = true;
                                }
                            }
                            Thread.sleep(1000);//停止1s再执行
                        } catch (InterruptedException ex) {
                            Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                        }
                    } while (!allThreadFinished);//
                    long endTime = System.currentTimeMillis();
                    long diff = endTime - startTime;
                    bottomStatusjLabel.setText("转换完成。耗时:" + DessertShopConfigParseJFrame.formatTimeDuration(diff));
                    currentUIObject.transformFinish("完成转换!");
                } catch (IOException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class
                            .getName()).log(Level.SEVERE, null, ex);
                    showMessageDialogMessage(ex);
                } catch (BiffException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class
                            .getName()).log(Level.SEVERE, null, ex);
                    showMessageDialogMessage(ex);
                }
            }
        }).start();
    }

    /**
     * mission 特例
     *
     * @param configFilePath
     * @param outputPath
     * @param fileName
     * @param sheetName
     * @param idField
     * @param specialField
     * @param keys
     * @param contentSplitFragment
     * @param combineFields
     */
    public void transformMissionContent(final String configFilePath, final String outputPath, final String fileName, final String sheetName, final String idField, final Map specialField, final String keys, final String contentSplitFragment, final Map combineFields) {
        final long startTime = System.currentTimeMillis();
        final List<Thread> threadList = new ArrayList();
        final DessertShopConfigParseJFrame currentUIObject = this;

        new Thread(new Runnable() {
            @Override
            public void run() {
                try {
                    int sheetIndex = getSheetIndexBySheetName(configFilePath, sheetName);
                    final String[][] originContent = parseXls(configFilePath, sheetIndex, true);

                    final Map<String, Map<String, List>> modelInfo = getModel(originContent[0], combineFields);
                    final Map<String, Map<String, List>> fullModelInfo = getModel(originContent[0]);
                    String[] langList = getLangs();

                    for (final String currentLang : langList) {
                        // start single lang 
                        final String[][] singleLangContent = cleanupOriginContent(originContent, currentLang, fullModelInfo, combineFields);
                        Thread currentThread = transformMissionThread(currentLang, outputPath, fileName, modelInfo, singleLangContent, idField, specialField, keys, contentSplitFragment, combineFields);
                        currentThread.start();
                        threadList.add(currentThread);
                        //end single lang
                    }

                    boolean allThreadFinished;
                    do {
                        allThreadFinished = false;
                        try {
                            for (Thread t : threadList) {
                                if (t.getState() != Thread.State.TERMINATED) {
                                    allThreadFinished = false;
                                    break;
                                } else {
                                    allThreadFinished = true;
                                }
                            }
                            Thread.sleep(1000);//停止1s再执行
                        } catch (InterruptedException ex) {
                            Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                        }
                    } while (!allThreadFinished);//
                    long endTime = System.currentTimeMillis();
                    long diff = endTime - startTime;
                    bottomStatusjLabel.setText("转换完成。耗时:" + DessertShopConfigParseJFrame.formatTimeDuration(diff));
                    currentUIObject.transformFinish("完成转换!");
                } catch (IOException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class
                            .getName()).log(Level.SEVERE, null, ex);
                    showMessageDialogMessage(ex);
                } catch (BiffException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class
                            .getName()).log(Level.SEVERE, null, ex);
                    showMessageDialogMessage(ex);
                }
            }
        }).start();
    }

    public String[][] cleanupOriginContent(final String[][] originContent, String currentLang, Map<String, Map<String, List>> modelInfo, Map<String, String[]> combineFields) {
        String[][] finalContent = new String[originContent.length][originContent[0].length];
//        System.arraycopy(originContent, 0, finalContent, 0, originContent.length);//这个会影响到 originContent 这个数组。。。。
        for (int i = 0; i < originContent.length; i++) {
            System.arraycopy(originContent[i], 0, finalContent[i], 0, originContent[i].length);
        }
        List<String> fileNameInModelInfoList = modelInfo.get("fieldName").get(currentLang);
        List<Integer> fileIndexInModelInfoList = modelInfo.get("fieldIndex").get(currentLang);
        Map<Integer, Integer[]> finalIndexMap = new HashMap();
        for (Entry<String, String[]> entry : combineFields.entrySet()) {
            String key = entry.getKey();
            String[] value = entry.getValue();
            int valueLen = value.length;
            int keyIndex = getFieldIndexByFieldName(fileNameInModelInfoList, key);
            List<Integer> current = new ArrayList();
            for (int i = 0; i < valueLen; i++) {
                int currentValueIndex = getFieldIndexByFieldName(fileNameInModelInfoList, fileIndexInModelInfoList, value[i]);
                current.add(currentValueIndex);
            }
            finalIndexMap.put(keyIndex, current.toArray(new Integer[current.size()]));
        }
        int rowNum = finalContent.length;
        for (int rowCount = 1; rowCount < rowNum; rowCount++) {
            int columnNum = finalContent[rowCount].length;
            for (int columnCount = 0; columnCount < columnNum; columnCount++) {
                if (finalIndexMap.containsKey(columnCount)) {
                    String originColumnContent = finalContent[rowCount][columnCount];
                    String[] originColumnContentArray = originColumnContent.split(",");
                    for (int i = 0; i < originColumnContentArray.length; i++) {
                        originColumnContentArray[i] = originColumnContentArray[i].replaceAll(":", MISSION_REQUIRE_SECOND_FLOOR);
                    }
                    int originColumnContentNum = originColumnContentArray.length;
                    Integer[] combineColumnArray = finalIndexMap.get(columnCount);
                    int combineColumnNum = combineColumnArray.length;
                    for (int combineColumnIndex = 0; combineColumnIndex < combineColumnNum; combineColumnIndex++) {
                        String[] currentCombineColumnContentArray = finalContent[rowCount][combineColumnArray[combineColumnIndex]].split("\\|");
                        if (currentCombineColumnContentArray.length == originColumnContentArray.length) {//有的时候 数据会不一致  直接无视 艹 坑爹玩意
                            for (int originColumnContentIndex = 0; originColumnContentIndex < originColumnContentNum; originColumnContentIndex++) {
                                originColumnContentArray[originColumnContentIndex] = originColumnContentArray[originColumnContentIndex] + MISSION_REQUIRE_SECOND_FLOOR + currentCombineColumnContentArray[originColumnContentIndex];
                            }
                        } else {
                            for (int originColumnContentIndex = 0; originColumnContentIndex < originColumnContentNum; originColumnContentIndex++) {
                                originColumnContentArray[originColumnContentIndex] = originColumnContentArray[originColumnContentIndex] + MISSION_REQUIRE_SECOND_FLOOR + " ";
                            }
                        }

                    }
                    //combineColumnArray
                    finalContent[rowCount][columnCount] = arrayImplode(originColumnContentArray, MISSION_REQUIRE_FIRST_FLOOR);
                }
            }
        }
        return finalContent;
    }

    /**
     * 通用
     *
     * @param configFilePath
     * @param outputPath
     * @param fileName
     * @param sheetName
     * @param idField
     * @param specialField
     * @param keys
     * @param contentSplitFragment
     */
    public void transformCommonContent(final String configFilePath, final String outputPath, final String fileName, final String sheetName, final String idField, final Map specialField, final String keys, final String contentSplitFragment) {
        final long startTime = System.currentTimeMillis();
        final List<Thread> threadList = new ArrayList();
        final DessertShopConfigParseJFrame currentUIObject = this;

        new Thread(new Runnable() {
            @Override
            public void run() {
                try {
                    int sheetIndex = getSheetIndexBySheetName(configFilePath, sheetName);
                    final String[][] commonContent = parseXls(configFilePath, sheetIndex, true);

                    final Map<String, Map<String, List<String>>> modelInfo = getModel(commonContent[0]);
                    String[] langList = getLangs();

                    for (final String currentLang : langList) {
                        // start single lang 
                        Thread currentThread = transformCommonThread(currentLang, outputPath, fileName, modelInfo, commonContent, idField, specialField, keys, contentSplitFragment);
                        currentThread.start();
                        threadList.add(currentThread);
                        //end single lang
                    }

                    boolean allThreadFinished;
                    do {
                        allThreadFinished = false;
                        try {
                            for (Thread t : threadList) {
                                if (t.getState() != Thread.State.TERMINATED) {
                                    allThreadFinished = false;
                                    break;
                                } else {
                                    allThreadFinished = true;
                                }
                            }
                            Thread.sleep(1000);//停止1s再执行
                        } catch (InterruptedException ex) {
                            Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                        }
                    } while (!allThreadFinished);//
                    long endTime = System.currentTimeMillis();
                    long diff = endTime - startTime;
                    bottomStatusjLabel.setText("转换完成。耗时:" + DessertShopConfigParseJFrame.formatTimeDuration(diff));
                    currentUIObject.transformFinish("完成转换!");
                } catch (IOException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class
                            .getName()).log(Level.SEVERE, null, ex);
                    showMessageDialogMessage(ex);
                } catch (BiffException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class
                            .getName()).log(Level.SEVERE, null, ex);
                    showMessageDialogMessage(ex);
                }
            }
        }).start();
    }

    /**
     * 通用
     *
     * @param configFilePath
     * @param outputPath
     * @param fileName
     * @param sheetName
     * @param specialField
     */
    public void transformCommonSingleFileContent(final String configFilePath, final String outputPath, final String fileName, final String sheetName, final Map specialField) {
        final long startTime = System.currentTimeMillis();
        final List<Thread> threadList = new ArrayList();
        final DessertShopConfigParseJFrame currentUIObject = this;

        new Thread(new Runnable() {
            @Override
            public void run() {
                try {
                    int sheetIndex = getSheetIndexBySheetName(configFilePath, sheetName);
                    final String[][] commonContent = parseXls(configFilePath, sheetIndex, true);

                    final Map<String, Map<String, List<String>>> modelInfo = getModel(commonContent[0]);
                    String[] langList = getLangs();

                    for (final String currentLang : langList) {
                        // start single lang 
                        Thread currentThread = transformCommonSingleFileThread(currentLang, outputPath, fileName, modelInfo, commonContent, specialField);
                        currentThread.start();
                        threadList.add(currentThread);
                        //end single lang
                    }

                    boolean allThreadFinished;
                    do {
                        allThreadFinished = false;
                        try {
                            for (Thread t : threadList) {
                                if (t.getState() != Thread.State.TERMINATED) {
                                    allThreadFinished = false;
                                    break;
                                } else {
                                    allThreadFinished = true;
                                }
                            }
                            Thread.sleep(1000);//停止1s再执行
                        } catch (InterruptedException ex) {
                            Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                        }
                    } while (!allThreadFinished);//
                    long endTime = System.currentTimeMillis();
                    long diff = endTime - startTime;
                    bottomStatusjLabel.setText("转换完成。耗时:" + DessertShopConfigParseJFrame.formatTimeDuration(diff));
                    currentUIObject.transformFinish("完成转换!");
                } catch (IOException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class
                            .getName()).log(Level.SEVERE, null, ex);
                    showMessageDialogMessage(ex);
                } catch (BiffException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class
                            .getName()).log(Level.SEVERE, null, ex);
                    showMessageDialogMessage(ex);
                }
            }
        }).start();
    }

    private Thread transformCommonSingleFileThread(final String currentLang, final String outputPath, final String fileName, final Map<String, Map<String, List<String>>> modelInfo, final String[][] commonContent, final Map specialField) {
        Thread currentThread = new Thread(new Runnable() {
            @Override
            public void run() {
                for (int i = 1; i < commonContent.length; i++) {
                    Map<String, String> singleRowInfo = buildSingleRowStr(commonContent[i], modelInfo, currentLang, specialField);
                    String singleItemInfo = singleRowInfo.get("singleRowInfo");
                    String descFile = buildSingleRowStoredPath(currentLang, "", outputPath, fileName);
                    try {
                        writeToFile("<?php\r\n return " + singleItemInfo, descFile, "UTF-8");
                    } catch (FileNotFoundException ex) {
                        Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                    } catch (IOException ex) {
                        Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                    }
                    bottomStatusjLabel.setText("语言：" + currentLang + "完成度:" + (i * 100 / commonContent.length) + "%|正在生成文件:" + outputPath);
                }
            }
        });
        return currentThread;
    }

    private Thread transformCommonThread(final String currentLang, final String outputPath, final String fileName, final Map<String, Map<String, List<String>>> modelInfo, final String[][] commonContent, final String idField, final Map specialField) {
        Thread currentThread = new Thread(new Runnable() {
            @Override
            public void run() {
                int idIndex = DessertShopConfigParseJFrame.getFieldIndexByFieldName(modelInfo.get("fieldName").get(currentLang), idField);
                StringBuilder allContent = new StringBuilder();
                allContent.append(" return array (\r\n");
                for (int i = 1; i < commonContent.length; i++) {
                    Map<String, String> singleRowInfo = buildSingleRowStr(commonContent[i], modelInfo, currentLang, idIndex, idField, specialField);
                    String id = singleRowInfo.get(idField);
                    if (!id.isEmpty()) {//空id 直接无视
                        String singleItemInfo = singleRowInfo.get("singleRowInfo");
                        String currentAllItemInfo = singleRowInfo.get("allRowsInfo");
                        String descFile = buildSingleRowStoredPath(currentLang, id, outputPath, fileName, fileName);
                        try {
                            writeToFile("<?php\r\n return " + singleItemInfo, descFile, "UTF-8");
                        } catch (FileNotFoundException ex) {
                            Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                        } catch (IOException ex) {
                            Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                        }
                        if (i == 1) {//第一行 没有必要添加\r\n
                            allContent.append(currentAllItemInfo);
                        } else {
                            allContent.append("\r\n").append(currentAllItemInfo);
                        }
                        bottomStatusjLabel.setText("语言：" + currentLang + "完成度:" + (i * 100 / commonContent.length) + "%|正在生成文件:" + outputPath);
                    }
                }
                try {
                    bottomStatusjLabel.setText("语言：" + currentLang + "完成度:" + "100%|正在生成文件:" + outputPath);
                    String descFile = buildSingleRowStoredPath(currentLang, "", outputPath, fileName, fileName);
                    writeToFile("<?php\r\n" + allContent.toString() + "\r\n);", descFile, "UTF-8");
                } catch (FileNotFoundException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                } catch (IOException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                }
            }
        });
        return currentThread;
    }

    private Thread transformMissionThread(final String currentLang, final String outputPath, final String fileName, final Map<String, Map<String, List>> modelInfo, final String[][] commonContent, final String idField, final Map specialField, final String keys, final String contentSplitFragment, final Map combineFields) {
        Thread currentThread = new Thread(new Runnable() {
            @Override
            public void run() {
                int idIndex = DessertShopConfigParseJFrame.getFieldIndexByFieldName(modelInfo.get("fieldName").get(currentLang), idField);
                StringBuilder allContent = new StringBuilder();
                allContent.append(" return array (\r\n");
                for (int i = 1; i < commonContent.length; i++) {
                    Map<String, String> singleRowInfo = buildMissionSingleRowStr(commonContent[i], modelInfo, currentLang, idIndex, idField, specialField, keys, contentSplitFragment, combineFields);
                    String id = singleRowInfo.get(idField);
                    if (!id.isEmpty()) {//空id 直接无视
                        String singleItemInfo = singleRowInfo.get("singleRowInfo");
                        String currentAllItemInfo = singleRowInfo.get("allRowsInfo");
                        String descFile = buildSingleRowStoredPath(currentLang, id, outputPath, fileName, fileName);
                        try {
                            writeToFile("<?php\r\n return " + singleItemInfo, descFile, "UTF-8");
                        } catch (FileNotFoundException ex) {
                            Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                        } catch (IOException ex) {
                            Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                        }
                        if (i == 1) {//第一行 没有必要添加\r\n
                            allContent.append(currentAllItemInfo);
                        } else {
                            allContent.append("\r\n").append(currentAllItemInfo);
                        }
                        bottomStatusjLabel.setText("语言：" + currentLang + "完成度:" + (i * 100 / commonContent.length) + "%|正在生成文件:" + outputPath);
                    }
                }
                try {
                    bottomStatusjLabel.setText("语言：" + currentLang + "完成度:" + "100%|正在生成文件:" + outputPath);
                    String descFile = buildSingleRowStoredPath(currentLang, "", outputPath, fileName, fileName);
                    writeToFile("<?php\r\n" + allContent.toString() + "\r\n);", descFile, "UTF-8");
                } catch (FileNotFoundException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                } catch (IOException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                }
            }
        });
        return currentThread;
    }

    private Thread transformCommonThread(final String currentLang, final String outputPath, final String fileName, final Map<String, Map<String, List<String>>> modelInfo, final String[][] commonContent, final String idField, final Map specialField, final String keys, final String contentSplitFragment) {
        Thread currentThread = new Thread(new Runnable() {
            @Override
            public void run() {
                int idIndex = DessertShopConfigParseJFrame.getFieldIndexByFieldName(modelInfo.get("fieldName").get(currentLang), idField);
                StringBuilder allContent = new StringBuilder();
                allContent.append(" return array (\r\n");
                for (int i = 1; i < commonContent.length; i++) {
                    Map<String, String> singleRowInfo = buildSingleRowStr(commonContent[i], modelInfo, currentLang, idIndex, idField, specialField, keys, contentSplitFragment);
                    String id = singleRowInfo.get(idField);
                    if (!id.isEmpty()) {//空id 直接无视
                        String singleItemInfo = singleRowInfo.get("singleRowInfo");
                        String currentAllItemInfo = singleRowInfo.get("allRowsInfo");
                        String descFile = buildSingleRowStoredPath(currentLang, id, outputPath, fileName, fileName);
                        try {
                            writeToFile("<?php\r\n return " + singleItemInfo, descFile, "UTF-8");
                        } catch (FileNotFoundException ex) {
                            Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                        } catch (IOException ex) {
                            Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                        }
                        if (i == 1) {//第一行 没有必要添加\r\n
                            allContent.append(currentAllItemInfo);
                        } else {
                            allContent.append("\r\n").append(currentAllItemInfo);
                        }
                        bottomStatusjLabel.setText("语言：" + currentLang + "完成度:" + (i * 100 / commonContent.length) + "%|正在生成文件:" + outputPath);
                    }
                }
                try {
                    bottomStatusjLabel.setText("语言：" + currentLang + "完成度:" + "100%|正在生成文件:" + outputPath);
                    String descFile = buildSingleRowStoredPath(currentLang, "", outputPath, fileName, fileName);
                    writeToFile("<?php\r\n" + allContent.toString() + "\r\n);", descFile, "UTF-8");
                } catch (FileNotFoundException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                } catch (IOException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class.getName()).log(Level.SEVERE, null, ex);
                }
            }
        });
        return currentThread;
    }

    /**
     * 格式化
     *
     * @param duration
     * @return
     */
    private static String formatTimeDuration(long duration) {
        long ssec = duration % 1000;// 毫秒
        long sec = (duration / 1000) % 60;// 秒
        long min = (duration / 1000 / 60) % 60; // 分钟
        long hour = (duration / 1000 / 60 / 60) % 24;// 小时
        long day = duration / 1000 / 60 / 60 / 24;// 天
        return String.format("%02d day %02d:%02d:%02d", day, hour, min, sec);
    }

    /**
     * 需要跳过的field
     *
     * @param combineFields
     * @return
     */
    private List<String> needSkipedFields(Map<String, String[]> combineFields) {
        List<String> needSkipedFields = new ArrayList();

        for (String key : combineFields.keySet()) {
            String[] value = combineFields.get(key);
            int len = value.length;
            for (int i = 0; i < len; i++) {
                needSkipedFields.add(value[i]);
            }
        }

        return needSkipedFields;
    }

    public Map getModel(String[] dsOpengraphCfg, Map<String, String[]> combineFields) {
        Map<String, List<Integer>> fieldIndex = new HashMap();
        Map<String, List<String>> fieldName = new HashMap();
        String[] langList = getLangs();
        List needSkipedFields = needSkipedFields(combineFields);

        for (int i = 0; i < langList.length; i++) {
            String currentLang = langList[i];
            fieldIndex.put(currentLang, new ArrayList());
            fieldName.put(currentLang, new ArrayList());
        }
        for (int j = 0; j < dsOpengraphCfg.length; j++) {
            String originField = dsOpengraphCfg[j];
            boolean currentPrefixIsLang = false;
            String prefix = "";
            if (!originField.trim().isEmpty()) {
                if (originField.length() >= 6) {//查看是否为属于某个特定的语言
                    prefix = originField.substring(0, 5);
                    currentPrefixIsLang = Arrays.asList(langList).contains(prefix);
                }
                if (currentPrefixIsLang) {//当前field 只属于某一个lang
                    List currentModelIndex = fieldIndex.get(prefix);
                    List currentModelField = fieldName.get(prefix);
                    String currentFiled = originField.substring(6);
                    if (!needSkipedFields.contains(currentFiled)) {//需要掉过的field不需要出现在最终的model中
                        currentModelIndex.add(j);
                        currentModelField.add(currentFiled);
                    }
                } else {//当前field 属于所有lang
                    if (!needSkipedFields.contains(originField)) {//需要掉过的field不需要出现在最终的model中
                        for (int i = 0; i < langList.length; i++) {
                            String currentLang = langList[i];
                            List currentModelIndex = fieldIndex.get(currentLang);
                            List currentModelField = fieldName.get(currentLang);
                            currentModelIndex.add(j);
                            currentModelField.add(originField);
                        }
                    }
                }
            }
        }

        Map finalInfo = new HashMap();
        finalInfo.put("fieldIndex", fieldIndex);
        finalInfo.put("fieldName", fieldName);
        return finalInfo;
    }

    /**
     *
     * @param dsOpengraphCfg
     * @return
     */
    public Map getModel(String[] dsOpengraphCfg) {
        Map<String, List<Integer>> fieldIndex = new HashMap();
        Map<String, List<String>> fieldName = new HashMap();
        String[] langList = getLangs();
        for (int i = 0; i < langList.length; i++) {
            String currentLang = langList[i];
            fieldIndex.put(currentLang, new ArrayList());
            fieldName.put(currentLang, new ArrayList());
        }
        for (int j = 0; j < dsOpengraphCfg.length; j++) {
            String originField = dsOpengraphCfg[j];
            boolean currentPrefixIsLang = false;
            String prefix = "";
            if (!originField.trim().isEmpty()) {
                if (originField.length() >= 6) {
                    prefix = originField.substring(0, 5);
                    currentPrefixIsLang = Arrays.asList(langList).contains(prefix);
                }
                if (currentPrefixIsLang) {//当前field 只属于某一个lang
                    List currentModelIndex = fieldIndex.get(prefix);
                    List currentModelField = fieldName.get(prefix);
                    currentModelIndex.add(j);
                    String currentFiled = originField.substring(6);
                    currentModelField.add(currentFiled);
                } else {//当前field 属于所有lang
                    for (int i = 0; i < langList.length; i++) {
                        String currentLang = langList[i];
                        List currentModelIndex = fieldIndex.get(currentLang);
                        List currentModelField = fieldName.get(currentLang);
                        currentModelIndex.add(j);
                        currentModelField.add(originField);
                    }
                }
            }
        }

        Map finalInfo = new HashMap();
        finalInfo.put("fieldIndex", fieldIndex);
        finalInfo.put("fieldName", fieldName);
        return finalInfo;
    }

    public String getSingleRowContent(String[] dsOpengraphCfg) {

        return "";
    }

    public String getSingleRowContentByLang(String[] dsOpengraphCfg, String lang) {

        return "";
    }

    public static String[] getLangs() {
        return new String[]{"zh_tw", "de_de", "fr_fr", "en_us", "es_es"};
    }


    private void closejButtonMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_closejButtonMouseClicked
        // TODO add your handling code here:
        this.dispose();
    }//GEN-LAST:event_closejButtonMouseClicked

    private void settingjMenuItemMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_settingjMenuItemMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_settingjMenuItemMouseClicked

    private void outputjButtonMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_outputjButtonMouseClicked
        this.outputjTextFieldMouseClicked(evt);
    }//GEN-LAST:event_outputjButtonMouseClicked

    private void outputjTextFieldMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_outputjTextFieldMouseClicked
        File f = new File(outputDirectory);
        JFileChooser jfc = new JFileChooser(f);
        jfc.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
        int result;
        result = jfc.showOpenDialog(null);
        if (result == JFileChooser.APPROVE_OPTION) {
            File file = jfc.getSelectedFile();
            outputjTextField.setText(file.getPath());
        }
    }//GEN-LAST:event_outputjTextFieldMouseClicked

    private void configFilejButtonMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_configFilejButtonMouseClicked
        this.configFilejTextFieldMouseClicked(evt);
    }//GEN-LAST:event_configFilejButtonMouseClicked

    private void configFilejTextFieldMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_configFilejTextFieldMouseClicked
        File f = new File(configBaseDir);
        JFileChooser jfc = new JFileChooser(f);
        //        jfc.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
        int result;
        result = jfc.showOpenDialog(null);
        if (result == JFileChooser.APPROVE_OPTION) {
            File file = jfc.getSelectedFile();
            configFilejTextField.setText(file.getPath());
        }
    }//GEN-LAST:event_configFilejTextFieldMouseClicked

    private void ChangeConfigFilejTextField() {
        String key;
        if (funcbuttonGroup.getSelection() != null) {
            key = funcbuttonGroup.getSelection().getActionCommand();
            configFilejTextField.setText(configBaseDir + "/" + fileMapping.get(key));
        }
    }

//    public String buildFinalBundleingSaleStringFromStringArrayx(String func, int sheetNum, String[][] content) {
//        int rows = content.length;
//        int cols = content[0].length;
//        String buildedContent = "";
//
//        return buildedContent;
//    }
    /**
     * 将时间字符串转换为时间戳
     *
     * @param timeString
     * @return
     */
    public static long timeStringTotimeStamp(String timeString) {
        return timeStringTotimeStamp(timeString, "yyyy-MM-dd HH:mm:ss");
    }

    /**
     * 将时间字符串转换为时间戳
     *
     * @param timeString
     * @param format
     * @return
     */
    public static long timeStringTotimeStamp(String timeString, String format) {
        SimpleDateFormat simpleDateFormat = new SimpleDateFormat(format);
        Date date;
        long timeStamp = 0;
        try {
            date = simpleDateFormat.parse(timeString);
            timeStamp = date.getTime();

        } catch (ParseException ex) {
            Logger.getLogger(DessertShopConfigParseJFrame.class
                    .getName()).log(Level.SEVERE, null, ex);
        }

        return timeStamp;
    }

    public static String getInitials(String s) {
        return getInitials(s, true);
    }

    public static String getInitials(String s, boolean withFirstLetter) {
        if (s == null) {
            return null;
        }
        StringBuilder sb = new StringBuilder(s.length());
        boolean upperCase = false;

        for (int i = 0; i < s.length(); i++) {
            char c = s.charAt(i);
            if (c == '_') {
                upperCase = true;
            } else if (upperCase) {
                sb.append(Character.toUpperCase(c));
                upperCase = false;
            } else {
                sb.append(c);
            }
        }
        s = sb.toString();
        sb = new StringBuilder();

        if (withFirstLetter) {
            sb.append(s.charAt(0));
        }

        for (int i = 0; i < s.length(); i++) {
            char c = s.charAt(i);
            if (Character.isUpperCase(c)) {
                sb.append(Character.toLowerCase(c));
            }
        }
        return sb.toString();
    }

    public String stringJoin(String[] origon, String glue) {
        StringBuffer sb;
        sb = new StringBuffer();
        int origonLength = origon.length;
        for (int i = 0; i < origonLength; i++) {
            sb.append(origon[i]);
            if (i < origonLength - 1) {
                sb.append(glue);
            }
        }
        return sb.toString();
    }

    public String[] getStringArrayBySingleIndex(String[][] content, int arrayIndex) {
        int rowCount = content.length;
        String[] stringArray = new String[rowCount];
        for (int rowNum = 0; rowNum < rowCount; rowNum++) {
            stringArray[rowNum] = content[rowNum][arrayIndex];
        }
        return stringArray;
    }

    public String[][] getStringArrayByIndex(String[][] content, int[] arrayIndex) {
        int rowCount = content.length;
        int colCount = content[0].length;
        String[][] stringArray = new String[rowCount][arrayIndex.length];
        int arrayIndexValue;
        int j = 0, row, column, arrayIndexLength = arrayIndex.length;
        for (row = 0; row < rowCount; row++) {
            for (column = 0; column < arrayIndexLength; column++) {
                arrayIndexValue = arrayIndex[column];
                stringArray[row][column] = content[row][arrayIndexValue];
            }
        }

        String[][] finalStringArray = new String[j][colCount];
        System.arraycopy(stringArray, 0, finalStringArray, 0, j);
        return finalStringArray;
    }

    public String[][] getStringArrayByField(String[][] content, String value, int index) {
        int rowCount = content.length;
        int colCount = content[0].length;
        String[][] stringArray = new String[rowCount][colCount];
        int j = 0, row, startRow = -1, endRow = -1;

        for (row = 0; row < rowCount; row++) {
            String indexValue = content[row][index];
            if (indexValue.equals(value)) {
                if (startRow == -1) {
                    startRow = row;
                }
                endRow = row;
                stringArray[j++] = content[row];
            }
        }
        String[][] finalStringArray = new String[j][colCount];
        System.arraycopy(stringArray, 0, finalStringArray, 0, j);
        return finalStringArray;
    }

    public static String getCurrentTimeString() {
        return getCurrentTimeString("yyyy/MM/dd HH:mm:ss");
    }

    public static String getCurrentTimeString(String format) {
        String currentTimeString = "";
        SimpleDateFormat dateFormat = new SimpleDateFormat(format);//可以方便地修改日期格式 
        Date now = new Date();
        currentTimeString = dateFormat.format(now);
        return currentTimeString;
    }

    public static String getTimeString(long nowTimeStamp, String format) {
        String currentTimeString = "";
        SimpleDateFormat dateFormat = new SimpleDateFormat(format);//可以方便地修改日期格式 
        Date now = new Date(nowTimeStamp);
        currentTimeString = dateFormat.format(now);
        return currentTimeString;
    }

    /**
     * ds opengraph
     *
     * @param func
     * @param sheetNum
     * @param content
     * @return
     */
    public String buildFinalDsOpengraphStringFromStringArray(String func, int sheetNum, String[][] content) {
        int rows = content.length;
        String buildedContent = "";
        buildedContent += "//******************************************************************************************************************\r\n"
                + "//ds opengraph\r\n";

        buildedContent += "$J7CONFIG['collectActivityItemExtend'] = array(\r\n";
        String collectActivityItemExtendFormat = "    '%s' => array(\r\n"
                + "        'iExtraOutput' => array(\r\n"
                + "            '%s' => array(\r\n"
                + "                'iActiveStartTime' =>  strtotime('%s'),\r\n"
                + "                'iActiveEndTime' =>  strtotime('%s'),\r\n"
                + "                'iRate' =>  '%s',\r\n"
                + "                'iOutputNum' =>  '%s',\r\n"
                + "            ),\r\n"
                + "        ),\r\n"
                + "    ),\r\n";
        for (int rowNum = 1; rowNum < rows; rowNum++) {
            if (!content[rowNum][0].isEmpty()) {
                String period = content[rowNum][1];
                HashMap<String, String> singleCollectActivityCommonConf = collectActivityCommonConf.get(period);
                String iActiveStartTime = singleCollectActivityCommonConf.get("startTime");
                String iActiveEndTime = singleCollectActivityCommonConf.get("endTime");
                String iOutputItemId = singleCollectActivityCommonConf.get("scoreId");
                String iRate = content[rowNum][2];
                String iOutputNum = content[rowNum][3];
                String itemId = content[rowNum][0];
                buildedContent += String.format(collectActivityItemExtendFormat, itemId, iOutputItemId, iActiveStartTime, iActiveEndTime, iRate, iOutputNum);
            } else {
                break;
            }
        }
        buildedContent += ");";
        return buildedContent;
    }

    public String[] getModelFromStringArray(String[][] content) {
        String[] model;
        int i = 0;
        for (; i < content[0].length; i++) {
            if (content[0][i].isEmpty()) {
                break;
            }
        }
        model = new String[i];
        System.arraycopy(content[0], 0, model, 0, i);
        return model;
    }

    public int getFirstIndexFromArray(String[] content, String findMe) {
        int firstIndex = -1;
        String currentContent;
        int contentLength = content.length;
        for (int i = 0; i < contentLength; i++) {
            currentContent = content[i];
            if (currentContent.equals(findMe)) {
                firstIndex = i;
                break;
            }
        }
        return firstIndex;
    }

    public int getLastIndexFromArray(String[] content, String findMe) {
        int lastIndex = -1;
        String currentContent;
        int contentLength = content.length;
        for (int i = contentLength; i > 0; i--) {
            currentContent = content[i];
            if (currentContent.equals(findMe)) {
                lastIndex = i;
                break;
            }
        }
        return lastIndex;
    }

    public String buildStringFromStringArray(String func, int sheetNum, String[][] content) {
        String buildedContent = "";
        if ("DS_SHOP_OBJ_ITEM".equals(func)) {//ds shop object item
            buildedContent += buildFinalDsOpengraphStringFromStringArray(func, sheetNum, content);
        }
        return buildedContent;
    }

    public void writeToFile(String contents, File descFile) throws UnsupportedEncodingException, FileNotFoundException, IOException {
        writeToFile(contents, descFile, "UTF-8");
    }

    public static void writeToFile(String contents, File descFile, String encoding) throws UnsupportedEncodingException, FileNotFoundException, IOException {
        if (!descFile.getParentFile().exists()) {
            if (!descFile.getParentFile().mkdirs()) {
                JOptionPane.showMessageDialog(null, "创建目录文件所在的目录失败", "信息提示", JOptionPane.ERROR_MESSAGE);
                System.out.println("创建目录文件所在的目录失败！");
            }
        }
        if (!descFile.exists()) {
            descFile.createNewFile();
        }
        Writer writer = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(descFile), encoding));
        writer.write(contents);
        writer.flush();
        writer.close();
    }

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */

        fileMapping = new HashMap< Object, Object>();
        fileMapping.put("TOTEM", "t图腾.xls");
        fileMapping.put("UPGRADE_BUILDING", "j建筑升级.xls");
        fileMapping.put("BIGPACK", "d大礼包.xls");
        fileMapping.put("EXCHANGE", "e活动兑换--兑换任务.xls");
        fileMapping.put("TIGERITEMINFO", "y游乐场老虎机--实验室种子机.xls");
        fileMapping.put("FLOWERLAND_SPIN", "y游乐场老虎机--实验室种子机.xls");
        fileMapping.put("KEYMAPPING", "key mapping.xls");
        fileMapping.put("ADSGENERALIZE", "x小语种广告推广.xls");
        fileMapping.put("FSGENERALIZE", "x小语种花店推广.xls");
        fileMapping.put("SAPPHIREEXCHANGE", "b宝石兑换.xls");
        fileMapping.put("FLOWERCRAFT", "h花艺品.xls");
        fileMapping.put("FLORALBENCHUPRADE", "h花艺制作台升级.xls");
        fileMapping.put("UNLOCKFLOWERCRAFT", "h花艺品解锁.xls");
        fileMapping.put("FLORALBENCHGROUP", "h花艺制作台分组.xls");
        fileMapping.put("FLORALBENCHMAKELIST", "h花艺制作台制作清单.xls");
        fileMapping.put("GARDENEXPAND", "h后花园扩地.xls");
        fileMapping.put("ITEMEXTEND", "w物品扩展.xls");
        fileMapping.put("SLOTINFO", "l拉霸.xls");
        fileMapping.put("DIVINATION_INFO", "p评比占卜.xls");
        fileMapping.put("DIVINATION_EXCHANGE_INFO", "p评比兑换.xls");
        fileMapping.put("DIVINATION_COMMON_INFO", "p评比占卜通用信息.xls");
        fileMapping.put("VIRTUAL_CURRENCY", "x虚拟货币.xls");
        fileMapping.put("SIMPLY_TASK", "j简易任务.xls");
        fileMapping.put("FESTIVAL_ACTIVITY", "j节日活动.xls");
        fileMapping.put("LOGIN_POP_CONTENT", "d登陆弹窗内容.xls");
        fileMapping.put("ITEM", "w物品表.xls");
        fileMapping.put("POPWINDOWOPT", "t弹窗优化.xls");
        fileMapping.put("CASCA_AWARD", "j金币返还.xls");
        fileMapping.put("FLORALSCULPTURECHMAKELIST", "h花雕制作清单.xls");
        fileMapping.put("FLORALSCULPTURE", "h花雕底座配置&花雕解锁.xls");
        fileMapping.put("REWARD_MACHINE", "m免费送机器.xls");
        fileMapping.put("FLORALSCULPTURECOMMON", "h花雕产品.xls");
        fileMapping.put("COLLECT_ACTIVITY", "s收集活动.xls");
        fileMapping.put("FLOWER_CRAFT_UNLOCK_ACTIVITY", "h花艺解锁活动.xls");
        fileMapping.put("PARTY_ACTIVITY", "party活动.xls");
        fileMapping.put("FLORAL_SCULPTURE_CONVERT", "h花雕兑换活动.xls");
        fileMapping.put("DS_SHOP_OBJ_ITEM", "opengraph.xls");

        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;

                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(DessertShopConfigParseJFrame.class
                    .getName()).log(java.util.logging.Level.SEVERE, null, ex);
            showMessageDialogMessage(ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(DessertShopConfigParseJFrame.class
                    .getName()).log(java.util.logging.Level.SEVERE, null, ex);
            showMessageDialogMessage(ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(DessertShopConfigParseJFrame.class
                    .getName()).log(java.util.logging.Level.SEVERE, null, ex);
            showMessageDialogMessage(ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(DessertShopConfigParseJFrame.class
                    .getName()).log(java.util.logging.Level.SEVERE, null, ex);
            showMessageDialogMessage(ex);
        }
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            @Override
            public void run() {
                try {
                    UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());

                } catch (ClassNotFoundException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class
                            .getName()).log(Level.SEVERE, null, ex);
                } catch (InstantiationException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class
                            .getName()).log(Level.SEVERE, null, ex);
                } catch (IllegalAccessException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class
                            .getName()).log(Level.SEVERE, null, ex);
                } catch (UnsupportedLookAndFeelException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class
                            .getName()).log(Level.SEVERE, null, ex);
                }
                JFrame totemCfgFrame = new DessertShopConfigParseJFrame();
                totemCfgFrame.setLocationRelativeTo(null);
                totemCfgFrame.setVisible(true);
//                WindowsCenter.center(totemCfgFrame);
            }
        });
    }

    public static String[][] parseXls(String filePath) throws IOException, BiffException {
        //通过Workbook的静态方法getWorkbook选取Excel文件
        WorkbookSettings workbookSettings = getWorkbookSettings();
        Workbook workbook = Workbook.getWorkbook(new File(filePath), workbookSettings);
        int sheetTotal = workbook.getNumberOfSheets();
        Sheet sheet;
        int rows, cols;
        Cell cells[][];
        String[][] finalContents = {};
        String[][] tmpContents;
        //通过Workbook的getSheet方法选择第一个工作簿（从0开始）
        for (int sheetNum = 0; sheetNum < sheetTotal; sheetNum++) {
            sheet = workbook.getSheet(sheetNum);
            rows = sheet.getRows();
            cols = sheet.getColumns();
            cells = new Cell[cols][rows];
            tmpContents = new String[rows][cols];
            for (int i = 0; i < cols; i++) {
                for (int j = 0; j < rows; j++) {
                    cells[i][j] = sheet.getCell(i, j);
                    if (cells[i][j].getType() == CellType.DATE) {//对日期数据进行特殊处理，如果不处理的话 默认24h制会变成12小时制
                        tmpContents[j][i] = DessertShopConfigParseJFrame.formatTime(cells[i][j]);
                    } else {
                        String tmpContent = cells[i][j].getContents();
                        tmpContent = tmpContent.replace("\\'", "\'");//防止单引号已经被转义了 如果没有这一步骤的话 被转义的单引号就会出现问题
                        tmpContent = tmpContent.replace("\'", "\\'");//将所有的单引号进行转义
                        tmpContents[j][i] = tmpContent;
                    }
                }
            }
            if (finalContents.length > 0) {
                finalContents = unite(finalContents, tmpContents);//合并到最终的数组中
            } else {
                finalContents = tmpContents;
            }
        }

        workbook.close();
        return finalContents;
    }

    public static String[][] parseXls(String filePath, int sheetNum, boolean escapeSlash) throws IOException, BiffException {
        String[][] finalContents = DessertShopConfigParseJFrame.parseXls(filePath, sheetNum, true, escapeSlash);
        return finalContents;
    }

    public static WorkbookSettings getWorkbookSettings() {
        return getWorkbookSettings("ISO-8859-1");
    }

    public static WorkbookSettings getWorkbookSettings(String encoding) {
        WorkbookSettings workbookSettings = new WorkbookSettings();
        workbookSettings.setEncoding(encoding); //关键代码，解决乱码
        return workbookSettings;
    }

    public static String[][] parseXls(String filePath, int sheetNum, boolean reverse, boolean escapeSlash) throws IOException, BiffException {
        //通过Workbook的静态方法getWorkbook选取Excel文件
        WorkbookSettings workbookSettings = getWorkbookSettings();
        Workbook workbook = Workbook.getWorkbook(new File(filePath), workbookSettings);
        //通过Workbook的getSheet方法选择第一个工作簿（从0开始）
        Sheet sheet = workbook.getSheet(sheetNum);
        int rows = sheet.getRows();
        int cols = sheet.getColumns();
        Cell cells[][] = new Cell[cols][rows];
        String[][] finalContents;
        if (reverse) {
            finalContents = new String[rows][cols];
            for (int i = 0; i < cols; i++) {
                for (int j = 0; j < rows; j++) {
                    finalContents[j][i] = getTmpContent(sheet, i, j, escapeSlash);
                }
            }
        } else {
            finalContents = new String[cols][rows];
            for (int i = 0; i < cols; i++) {
                for (int j = 0; j < rows; j++) {
                    finalContents[i][j] = getTmpContent(sheet, i, j, escapeSlash);
                }
            }
        }

        workbook.close();
        return finalContents;
    }

    public static String getTmpContent(Sheet sheet, int i, int j, boolean escapeSlash) {
        Cell cells = sheet.getCell(i, j);
        String finalContents;
        if (cells.getType() == CellType.DATE) {//对日期数据进行特殊处理，如果不处理的话 默认24h制会变成12小时制
            finalContents = DessertShopConfigParseJFrame.formatTime(sheet.getCell(i, j));
        } else {
            String tmpContent = sheet.getCell(i, j).getContents();
            if (!isNumeric(tmpContent) && escapeSlash) {
                tmpContent = tmpContent.replace("\\'", "\'");//防止单引号已经被转义了 如果没有这一步骤的话 被转义的单引号就会出现问题
                tmpContent = tmpContent.replace("\'", "\\'");
            }
            finalContents = tmpContent;
        }
        return finalContents;
    }

    public static boolean isNumeric(String str) {
        for (int i = str.length(); --i >= 0;) {
            int chr = str.charAt(i);
            if (chr < 48 || chr > 57) {
                return false;
            }
        }
        return true;
    }

    public static String formatTime(Cell formatCell) {
        java.util.Date date = null;
        DateCell dateCell = (DateCell) formatCell;
        date = dateCell.getDate();
        //long time = (date.getTime() / 1000) - 60 * 60 * 8;
        TimeZone gmtZone = TimeZone.getTimeZone("GMT");
        //date.setTime(time * 1000);
        SimpleDateFormat formatter = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        formatter.setTimeZone(gmtZone);
        return formatter.format(date);

    }

    public static String getSheetNameBySheetIndex(String filePath, int sheetIndex) throws IOException, BiffException {
        Workbook workbook = Workbook.getWorkbook(new File(filePath));
        String[] sheetNames = workbook.getSheetNames();
        String sheetName = sheetNames[sheetIndex];
        return sheetName;
    }

    public static int getSheetIndexBySheetName(String filePath, String sheetName) throws IOException, BiffException {
        int sheetIndex = 0;
        Workbook workbook = Workbook.getWorkbook(new File(filePath));
        String[] sheetNames = workbook.getSheetNames();
        for (int index = 0; index < sheetNames.length; index++) {
            String currentSheetName = sheetNames[index];
            if (sheetName.equals(currentSheetName)) {
                sheetIndex = index;
                break;
            }
        }
        return sheetIndex;
    }

    public static int getSheetNumber(String filePath) throws IOException, BiffException {
        Workbook workbook = Workbook.getWorkbook(new File(filePath));
        int sheetNumber = workbook.getNumberOfSheets();
        return sheetNumber;
    }

    private void loadSetting(String file_path) {
        File f = new File(file_path);
        if (f.exists()) {
            Properties prop = new Properties();
            FileInputStream fis;
            try {
                fis = new FileInputStream(file_path);
                try {
                    prop.load(fis);

                } catch (IOException ex) {
                    Logger.getLogger(DessertShopConfigParseJFrame.class
                            .getName()).log(Level.SEVERE, null, ex);
                    showMessageDialogMessage(ex);
                }
                if (!prop.getProperty("configBaseDir", "").isEmpty()) {
                    try {
                        configBaseDir = new String(prop.getProperty("configBaseDir").getBytes("ISO-8859-1"), "UTF-8");
//                        System.out.println(configBaseDir);

                    } catch (UnsupportedEncodingException ex) {
                        Logger.getLogger(DessertShopConfigParseJFrame.class
                                .getName()).log(Level.SEVERE, null, ex);
                        showMessageDialogMessage(ex);
                    }

                }
                if (!prop.getProperty("outputDirectory", "").isEmpty()) {
                    try {
                        outputDirectory = new String(prop.getProperty("outputDirectory").getBytes("ISO-8859-1"), "UTF-8");
//                        System.out.println(outputDirectory);
                    } catch (UnsupportedEncodingException ex) {
                        showMessageDialogMessage(ex);
                        Logger
                                .getLogger(DessertShopConfigParseJFrame.class
                                        .getName()).log(Level.SEVERE, null, ex);
                    }

                }
            } catch (FileNotFoundException ex) {
                Logger.getLogger(DessertShopConfigParseJFrame.class
                        .getName()).log(Level.SEVERE, null, ex);
                showMessageDialogMessage(ex);
            }
        }
    }

    private static void showMessageDialogMessage(Exception ex) {
        String exMsg = ex.toString();
        JOptionPane.showMessageDialog(null, exMsg + new Throwable().getStackTrace()[1].toString(), "错误信息提示", JOptionPane.ERROR_MESSAGE);
    }

    public static String replace(String strSource, String strFrom, String strTo) {
        if (strSource == null) {
            return null;
        }
        int i = 0;
        if ((i = strSource.indexOf(strFrom, i)) >= 0) {
            char[] cSrc = strSource.toCharArray();
            char[] cTo = strTo.toCharArray();
            int len = strFrom.length();
            StringBuilder buf = new StringBuilder(cSrc.length);
            buf.append(cSrc, 0, i).append(cTo);
            i += len;
            int j = i;
            while ((i = strSource.indexOf(strFrom, i)) > 0) {
                buf.append(cSrc, j, i - j).append(cTo);
                i += len;
                j = i;
            }
            buf.append(cSrc, j, cSrc.length - j);
            return buf.toString();
        }
        return strSource;
    }

    // 二维数组纵向合并  
    private static String[][] unite(String[][] content1, String[][] content2) {
        String[][] newArrey = new String[][]{};
        List<String[]> list = new ArrayList<String[]>();
        list.addAll(Arrays.<String[]>asList(content1));
        list.addAll(Arrays.<String[]>asList(content2));
        return list.toArray(newArrey);
    }
    private static Map< Object, Object> fileMapping;
    private String configBaseDir;
    private String outputDirectory;
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JRadioButton activityLibraryjRadioButton;
    private javax.swing.JRadioButton allInOneNojRadioButton;
    private javax.swing.JRadioButton allInOneYesjRadioButton;
    private javax.swing.JPanel allInOnejPanel;
    private javax.swing.ButtonGroup allInOnejbuttonGroup;
    private javax.swing.JRadioButton avatarItemsjRadioButton;
    private javax.swing.JRadioButton bindingRecipejRadioButton;
    private javax.swing.JLabel bottomStatusjLabel;
    private javax.swing.JButton closejButton;
    private javax.swing.JButton configFilejButton;
    private javax.swing.JLabel configFilejLabel;
    private javax.swing.JTextField configFilejTextField;
    private javax.swing.JRadioButton dessertInfojRadioButton;
    private javax.swing.JToolBar dsParseConfjToolBar;
    private javax.swing.JMenu editjMenu;
    private javax.swing.JRadioButton feedInfojRadioButton;
    private javax.swing.JMenu filejMenu;
    private javax.swing.ButtonGroup funcbuttonGroup;
    private javax.swing.JPanel funjPanel;
    private javax.swing.JRadioButton gamejRadioButton;
    private javax.swing.JRadioButton goodsOrderjRadioButton;
    private javax.swing.JLayeredPane jLayeredPane;
    private javax.swing.JMenuBar jMenuBar;
    private javax.swing.JRadioButton missionInfojRadioButton;
    private javax.swing.JPanel operationjPanel;
    private javax.swing.JButton outputjButton;
    private javax.swing.JLabel outputjLabel;
    private javax.swing.JTextField outputjTextField;
    private javax.swing.JButton parsejButton;
    private javax.swing.JRadioButton requestInfojRadioButton;
    private javax.swing.JPanel selectConfgFilejPanel;
    private javax.swing.JMenuItem settingjMenuItem;
    private javax.swing.JRadioButton shopObjItemjRadioButton;
    // End of variables declaration//GEN-END:variables
}
